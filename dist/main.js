(()=>{"use strict";const e=e=>{let t=(e=>{const t=[];for(;t.length<5;){const e=Math.floor(10*Math.random());-1===t.indexOf(e)&&t.push(e)}return t})();function o(e){let t=[];for(let o=0;o<10;o++)t.push([e,o]);return t}let n={carrier:o(t[0]),battleship:o(t[1]),cruiser:o(t[2]),submarine:o(t[3]),destroyer:o(t[4])};return{id:e,get_ships:()=>n,hit:(e,t)=>{let o=e;console.log("Here is the player fgrom hit function",o);let[n,s]=o.grab_position(o,t);return null==n||null==s?(console.log("Doesnt exist!"),!1):(o.remove_piece(n,s),!0)},remove_piece:(e,t)=>{if(n[e].length<=1)return(e=>{delete n[e],console.log("Ship has been deleted since its array is empty.")})(e);const o=n[e].findIndex((e=>JSON.stringify(e)==JSON.stringify(t)));console.log("Here is the position reference, ",o),n[e].splice(o,1),console.log("Here is the updated ship_pieces afterwards:",n)},grab_position:(e,t)=>{let o=e;console.log("From grab position function, this is the position ",t);for(const e in n){let s=n[e].find((e=>JSON.stringify(e)==JSON.stringify(t)));if(null!=s)return console.log(`${o.id} was hit!`),console.log("Here is the property: ",e),[e,s]}return[null,null]},update_ship_array:e=>(n=null,n=e)}};!function(){let t=!0;const o=(()=>{let t=e("player"),o=e("aibot");function n(e,t){const o=e,n=t;let s=o.get_ships(),r=n.get_ships(),i=0,l=0;for(const e in s)e&&i++;for(const e in r)e&&l++;return i<1&&l>1?(console.log(`We have a winner. Its ${n.id}`),n.id):i>1&&l<1&&(console.log(`We have a winner. Its ${o.id}`),o.id)}return{player:t,aibot:o,update_coordinates:function(e,n){e===t.id?t.update_ship_array(n):o.update_ship_array(n)},check_if_ship_hit:function(e){let[s,r,i]=e;console.log("HERE IS THE ID ",s),console.log("HERE IS THE x ",r),console.log("HERE IS THE y ",i),s===t.id?(console.log("Player cell was clicked on."),o.hit(t,[r,i]),console.log("Player ships after everything was updated/deleted",t.get_ships())):s===o.id&&(console.log("Ai bot cell was clicked on."),t.hit(o,[r,i]),console.log("AI bot ships after everything was updated/deleted",o.get_ships())),n(t,o)},check_winner:n}})();let n={},s={};function r(e,t){let o=t;console.log(`This is ${e} ships`,o),console.log("This is the carrier array: ",o.carrier),console.log("This is the battleship array: ",o.battleship),console.log("This is the cruiser array: ",o.cruiser),console.log("This is the submarine array: ",o.submarine),console.log("This is the destroyer array: ",o.destroyer),i(e,"carrier",5,o.carrier),i(e,"battleship",4,o.battleship),i(e,"cruiser",3,o.cruiser),i(e,"submarine",3,o.submarine),i(e,"destroyer",2,o.destroyer)}function i(e,t,r,i){let c=i;const d=Array.from(document.querySelectorAll(`.grid-cell-${e}-board`));let h=c[0][0],u=l();d.forEach((e=>{console.log(h==e.dataset.x)}));let p=d.filter((e=>e.dataset.x==h));console.log(p);let y=Math.ceil(p.length/2);if(console.log("This is found array before split",p),0===u){let o=p.slice(0,y).slice(0,y).slice(0,r);console.log("This is the found array now first half",o),o.forEach((o=>o.className=`grid-cell-${e}-board ${t}`))}else{let o=p.slice(y).slice(`-${r}`);console.log("This is the found array now second half",o),o.forEach((o=>o.className=`grid-cell-${e}-board ${t}`))}console.log("Grab ship coords function",a(e,`${t}`)),e===o.aibot.id?(s[`${t}`]=a(e,`${t}`),console.log("This is the SHIPS from bot DOM now",s)):(n[`${t}`]=a(e,`${t}`),console.log("This is the SHIPS from DOM now",n))}const l=()=>Math.floor(2*Math.random()),a=(e,t)=>{let o=[];return Array.from(document.querySelectorAll(`.grid-cell-${e}-board`)).forEach((e=>{e.classList.contains(t)&&o.push([e.dataset.x,e.dataset.y])})),o};function c(e){const t=document.querySelector(`.${e}`);for(let o=0;o<10;o++){let n=o;for(let o=0;o<10;o++){const s=document.createElement("div");s.className=`grid-cell-${e}`,s.id=`${e.split("-")[0]}`,s.setAttribute("data-x",n),s.setAttribute("data-y",o),s.style.border="1px solid black",s.addEventListener("click",(t=>{s.textContent="X",(s.classList.contains("cruiser")&&"X"==s.textContent||s.classList.contains("battleship")&&"X"==s.textContent||s.classList.contains("submarine")&&"X"==s.textContent||s.classList.contains("destroyer")&&"X"==s.textContent||s.classList.contains("carrier")&&"X"==s.textContent)&&(d([t.target.id,t.target.dataset.x,t.target.dataset.y]),s.className=`grid-cell-${e.split("-")[0]}-board hit`,p()),u()})),s.addEventListener("input",(t=>{console.log("Input is fired here!"),(s.classList.contains("cruiser")&&"X"==s.textContent||s.classList.contains("battleship")&&"X"==s.textContent||s.classList.contains("submarine")&&"X"==s.textContent||s.classList.contains("destroyer")&&"X"==s.textContent||s.classList.contains("carrier")&&"X"==s.textContent)&&(d([t.target.id,t.target.dataset.x,t.target.dataset.y]),s.className=`grid-cell-${e.split("-")[0]}-board hit`,p())})),t.appendChild(s)}}}function d(e){let[t,n,s]=e;return o.check_if_ship_hit([t,n,s])}function h(){let e=document.querySelector(".aibot-board");!1!==t||"visible"!==e.style["pointer-events"]?!0!==t||"none"!==e.style["pointer-events"]||(e.style["pointer-events"]="visible"):e.style["pointer-events"]="none"}function u(){const e=document.querySelector(".winner");return!0===t?(console.log("PLAYERS TURN SINCE THIS IS PLAYER TURN: ",t),e.textContent="Players turn!",h(),void(t=!1)):(console.log("BOTS TURN SINCE THIS IS PLAYER_TURN: ",t),e.textContent="Bots turn!",setTimeout((()=>function(){let e=Math.floor(99*Math.random()),o=document.querySelector(".player-board"),n=o.children[e];for(;"X"===n.textContent;)console.log("Spot was already taken. Retrying for another empty cell."),e=Math.floor(100*Math.random()),n=o.children[e];return n.textContent="X",t=!0,function(){let e=document.querySelector(".player-board"),t=Array.from(e.children);console.log("Executing render bot hit function"),t.forEach((e=>{(e.classList.contains("cruiser")&&"X"==e.textContent||e.classList.contains("battleship")&&"X"==e.textContent||e.classList.contains("submarine")&&"X"==e.textContent||e.classList.contains("destroyer")&&"X"==e.textContent||e.classList.contains("carrier")&&"X"==e.textContent)&&(console.log("Bot actually hit a ship!"),d([e.id,e.dataset.x,e.dataset.y]),e.className=`grid-cell-${e.id.split("-")[0]}-board hit`,p())}))}(),u()}()),1e3),void h())}function p(){let e=document.querySelector(".winner"),t=document.querySelector(".declare-winner"),n=document.querySelector(".player-board"),s=document.querySelector(".aibot-board"),r=s.children,i=o.check_winner(o.player,o.aibot);("player"===i||"aibot"===i)&&(e.textContent="",e.style.display="flex",t.textContent="Player wins!",n.style["pointer-events"]="none",s.style["pointer-events"]="none",r.forEach((e=>e.style["pointer-events"]="none;")))}c(`${o.player.id}-board`),c(`${o.aibot.id}-board`),r(o.player.id,o.player.get_ships()),r(o.aibot.id,o.aibot.get_ships()),u(),o.update_coordinates(o.player.id,n),o.update_coordinates(o.aibot.id,s)}()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsIm1hcHBpbmdzIjoibUJBQUEsTUE0RkEsRUE1RmNBLElBV1YsSUFBSUMsRUFWZ0MsQ0FBQ0MsSUFDakMsTUFBTUMsRUFBTyxHQUNiLEtBQU9BLEVBQUtDLE9BUWlDLEdBUmxCLENBQ3ZCLE1BQU1DLEVBQVlDLEtBQUtDLE1BQXNCLEdBQWhCRCxLQUFLRSxXQUNELElBQTdCTCxFQUFLTSxRQUFRSixJQUNiRixFQUFLTyxLQUFLTCxFQUVsQixDQUNBLE9BQU9GLEdBRVVRLEdBQ3JCLFNBQVNDLEVBQTBCQyxHQUMvQixJQUFJQyxFQUFhLEdBQ2pCLElBQUssSUFBSUMsRUFBSSxFQUFHQSxFQUFJLEdBQUlBLElBQ3BCRCxFQUFXSixLQUFLLENBQUNHLEVBQVFFLElBRzdCLE9BQU9ELENBQ1gsQ0FVQSxJQUFJRSxFQUhPLENBQUNDLFFBTE1MLEVBQTBCWCxFQUFlLElBS3ZDaUIsV0FKQ04sRUFBMEJYLEVBQWUsSUFJL0JrQixRQUhiUCxFQUEwQlgsRUFBZSxJQUdwQm1CLFVBRm5CUixFQUEwQlgsRUFBZSxJQUVab0IsVUFEN0JULEVBQTBCWCxFQUFlLEtBK0Q3RCxNQUFPLENBQUVELEtBQUlzQixVQTVDSyxJQUNQTixFQTJDYU8sSUF4Q1osQ0FBQ3ZCLEVBQUd3QixLQUNaLElBQUlDLEVBQVN6QixFQUNiMEIsUUFBUUMsSUFBSSx3Q0FBeUNGLEdBQ3JELElBQUtHLEVBQVdDLEdBQWlCSixFQUFPSyxjQUFjTCxFQUFPRCxHQUM3RCxPQUFpQixNQUFiSSxHQUFzQyxNQUFqQkMsR0FDckJILFFBQVFDLElBQUksa0JBQ0wsSUFFWEYsRUFBT00sYUFBYUgsRUFBVUMsSUFDdkIsRUFBSSxFQStCY0UsYUF4RFIsQ0FBQy9CLEVBQUd3QixLQUNyQixHQUFJUixFQUFZaEIsR0FBSUksUUFBVSxFQUMxQixNQTBCTyxDQUFDRCxXQUNMYSxFQUFZYixHQUNuQnVCLFFBQVFDLElBQUksa0RBQ04sRUE3QktLLENBQU9oQyxHQUVsQixNQUFNaUMsRUFBcUJqQixFQUFZaEIsR0FBSWtDLFdBQVdDLEdBQVNDLEtBQUtDLFVBQVVGLElBQVNDLEtBQUtDLFVBQVViLEtBQ3RHRSxRQUFRQyxJQUFJLG1DQUFvQ00sR0FDaERqQixFQUFZaEIsR0FBSXNDLE9BQU9MLEVBQW1CLEdBQzFDUCxRQUFRQyxJQUFJLDhDQUErQ1gsRUFFckQsRUErQ2lDYyxjQXRCckIsQ0FBQzlCLEVBQUd3QixLQUN0QixJQUFJQyxFQUFTekIsRUFDYjBCLFFBQVFDLElBQUkscURBQXNESCxHQUVsRSxJQUFLLE1BQU1lLEtBQVl2QixFQUFhLENBQ2hDLElBQ0l3QixFQURleEIsRUFBWXVCLEdBQ0VFLE1BQU1OLEdBQVNDLEtBQUtDLFVBQVVGLElBQVNDLEtBQUtDLFVBQVViLEtBQ3ZGLEdBQXFCa0IsTUFBakJGLEVBR0EsT0FGQWQsUUFBUUMsSUFBSSxHQUFHRixFQUFPekIsZUFDdEIwQixRQUFRQyxJQUFJLHlCQUEwQlksR0FDL0IsQ0FBQ0EsRUFBU0MsRUFFekIsQ0FDQSxNQUFPLENBQUMsS0FBSyxLQUFJLEVBU3FDRyxrQkFML0JDLElBQ3ZCNUIsRUFBYyxLQUNQQSxFQUFjNEIsR0FHbUQsR0NwRmhGLFdBQ0ksSUFBSUMsR0FBYyxFQUNsQixNQUFNQyxFQ0pRLE1BQ2QsSUFBSXJCLEVBQVMsRUFBSyxVQUNkc0IsRUFBUSxFQUFLLFNBNkJqQixTQUFTQyxFQUFhQyxFQUFVQyxHQUM1QixNQUFNekIsRUFBU3dCLEVBQ1RFLEVBQU1ELEVBQ1osSUFBSUUsRUFBZTNCLEVBQU9ILFlBQ3RCK0IsRUFBWUYsRUFBSTdCLFlBQ2hCZ0MsRUFBaUIsRUFDakJDLEVBQWMsRUFDbEIsSUFBSyxNQUFNaEIsS0FBWWEsRUFDaEJiLEdBQ0NlLElBR1IsSUFBSyxNQUFNZixLQUFZYyxFQUNoQmQsR0FDQ2dCLElBR1IsT0FBSUQsRUFBaUIsR0FBS0MsRUFBYyxHQUNwQzdCLFFBQVFDLElBQUkseUJBQXlCd0IsRUFBSW5ELE1BQ2xDbUQsRUFBSW5ELElBRVhzRCxFQUFpQixHQUFLQyxFQUFjLElBQ3BDN0IsUUFBUUMsSUFBSSx5QkFBeUJGLEVBQU96QixNQUNyQ3lCLEVBQU96QixHQUd0QixDQUdBLE1BQU8sQ0FBR3lCLFNBQVFzQixRQUFPUyxtQkF6RHpCLFNBQTRCUCxFQUFVUSxHQUM5QlIsSUFBY3hCLEVBQU96QixHQUNyQnlCLEVBQU9rQixrQkFBa0JjLEdBRXpCVixFQUFNSixrQkFBa0JjLEVBR2hDLEVBa0Q2Q0Msa0JBaEQ3QyxTQUEyQkMsR0FDdkIsSUFBSzNELEVBQUdhLEVBQVErQyxHQUFXRCxFQUMzQmpDLFFBQVFDLElBQUksa0JBQW1CM0IsR0FDL0IwQixRQUFRQyxJQUFJLGlCQUFrQmQsR0FDOUJhLFFBQVFDLElBQUksaUJBQWtCaUMsR0FDMUI1RCxJQUFPeUIsRUFBT3pCLElBQ2QwQixRQUFRQyxJQUFJLCtCQUNab0IsRUFBTXhCLElBQUlFLEVBQU8sQ0FBQ1osRUFBUStDLElBQzFCbEMsUUFBUUMsSUFBSSxvREFBcURGLEVBQU9ILGNBQ2pFdEIsSUFBTytDLEVBQU0vQyxLQUNwQjBCLFFBQVFDLElBQUksK0JBQ1pGLEVBQU9GLElBQUl3QixFQUFPLENBQUNsQyxFQUFRK0MsSUFDM0JsQyxRQUFRQyxJQUFJLG9EQUFxRG9CLEVBQU16QixjQUUzRTBCLEVBQWF2QixFQUFPc0IsRUFHeEIsRUErQmdFQyxlQUFjLEVEeERqRSxHQUNiLElBQUlhLEVBQWtCLENBQUMsRUFDbkJDLEVBQXNCLENBQUMsRUFnQjNCLFNBQVNDLEVBQWFkLEVBQVVlLEdBQzVCLElBQUlaLEVBQWVZLEVBQ25CdEMsUUFBUUMsSUFBSSxXQUFXc0IsVUFBbUJHLEdBQzFDMUIsUUFBUUMsSUFBSSw4QkFBK0J5QixFQUFzQixTQUNqRTFCLFFBQVFDLElBQUksaUNBQWtDeUIsRUFBeUIsWUFDdkUxQixRQUFRQyxJQUFJLDhCQUErQnlCLEVBQXNCLFNBQ2pFMUIsUUFBUUMsSUFBSSxnQ0FBaUN5QixFQUF3QixXQUNyRTFCLFFBQVFDLElBQUksZ0NBQWlDeUIsRUFBd0IsV0FDckVhLEVBQWdCaEIsRUFBVSxVQUFVLEVBQUVHLEVBQXNCLFNBQzVEYSxFQUFnQmhCLEVBQVUsYUFBYSxFQUFFRyxFQUF5QixZQUNsRWEsRUFBZ0JoQixFQUFVLFVBQVUsRUFBRUcsRUFBc0IsU0FDNURhLEVBQWdCaEIsRUFBVSxZQUFZLEVBQUVHLEVBQXdCLFdBQ2hFYSxFQUFnQmhCLEVBQVUsWUFBWSxFQUFFRyxFQUF3QixVQUNwRSxDQUdBLFNBQVNhLEVBQWdCaEIsRUFBVWlCLEVBQVNDLEVBQWFyRCxHQUNyRCxJQUFJWCxFQUFPVyxFQUNYLE1BQU1zRCxFQUFhQyxNQUFNQyxLQUFLQyxTQUFTQyxpQkFBaUIsY0FBY3ZCLFlBQ3RFLElBQUlwQyxFQUFVVixFQUFLLEdBQUcsR0FDbEJzRSxFQUFXQyxJQUNmTixFQUFXTyxTQUFTeEMsSUFDaEJULFFBQVFDLElBQUlkLEdBQVdzQixFQUFLeUMsUUFBUUMsRUFBQyxJQUV6QyxJQUFJQyxFQUFjVixFQUFXVyxRQUFRNUMsR0FDMUJBLEVBQUt5QyxRQUFRQyxHQUFLaEUsSUFFN0JhLFFBQVFDLElBQUltRCxHQUNaLElBQUlFLEVBQU8xRSxLQUFLMkUsS0FBS0gsRUFBWTFFLE9BQVMsR0FFMUMsR0FEQXNCLFFBQVFDLElBQUksbUNBQW9DbUQsR0FDL0IsSUFBYkwsRUFBZSxDQUNmLElBQUlTLEVBQVlKLEVBQVlLLE1BQU0sRUFBRUgsR0FDbkNHLE1BQU0sRUFBRUgsR0FDUkcsTUFBTSxFQUFFaEIsR0FDVHpDLFFBQVFDLElBQUkseUNBQTBDdUQsR0FDdERBLEVBQVVQLFNBQVN4QyxHQUFTQSxFQUFLaUQsVUFBWSxhQUFhbkMsV0FBbUJpQixLQUNqRixLQUFNLENBQ0YsSUFBSW1CLEVBQWFQLEVBQ2hCSyxNQUFNSCxHQUNORyxNQUFNLElBQUloQixLQUNYekMsUUFBUUMsSUFBSSwwQ0FBMkMwRCxHQUN2REEsRUFBV1YsU0FBU3hDLEdBQVNBLEVBQUtpRCxVQUFZLGFBQWFuQyxXQUFtQmlCLEtBQ2xGLENBQ0F4QyxRQUFRQyxJQUFJLDRCQUE2QjJELEVBQXNCckMsRUFBVSxHQUFHaUIsTUFDeEVqQixJQUFjSCxFQUFLQyxNQUFNL0MsSUFDekI4RCxFQUFvQixHQUFHSSxLQUFhb0IsRUFBc0JyQyxFQUFVLEdBQUdpQixLQUN2RXhDLFFBQVFDLElBQUkscUNBQXNDbUMsS0FFbERELEVBQWdCLEdBQUdLLEtBQWFvQixFQUFzQnJDLEVBQVUsR0FBR2lCLEtBQ25FeEMsUUFBUUMsSUFBSSxpQ0FBa0NrQyxHQUV0RCxDQUVBLE1BQU1hLEVBQXVCLElBQ1pwRSxLQUFLQyxNQUFzQixFQUFoQkQsS0FBS0UsVUFJM0I4RSxFQUF3QixDQUFDckMsRUFBVWlCLEtBQ3JDLElBQUlxQixFQUFlLEdBT25CLE9BTm1CbEIsTUFBTUMsS0FBS0MsU0FBU0MsaUJBQWlCLGNBQWN2QixZQUMzRDBCLFNBQVN4QyxJQUNaQSxFQUFLcUQsVUFBVUMsU0FBU3ZCLElBQ3hCcUIsRUFBYTdFLEtBQUssQ0FBQ3lCLEVBQUt5QyxRQUFRQyxFQUFFMUMsRUFBS3lDLFFBQVFjLEdBQ25ELElBRUdILEdBSVgsU0FBU0ksRUFBWTNGLEdBQ2pCLE1BQU00RixFQUFRckIsU0FBU3NCLGNBQWMsSUFBSTdGLEtBQ3pDLElBQUssSUFBSWUsRUFBSSxFQUFHQSxFQUFJLEdBQUlBLElBQUksQ0FDeEIsSUFBSStFLEVBQU0vRSxFQUNWLElBQUssSUFBSUEsRUFBSSxFQUFHQSxFQUFJLEdBQUlBLElBQUksQ0FDeEIsTUFBTWdGLEVBQU14QixTQUFTeUIsY0FBYyxPQUNuQ0QsRUFBSVgsVUFBWSxhQUFhcEYsSUFDN0IrRixFQUFJL0YsR0FBSyxHQUFHQSxFQUFHaUcsTUFBTSxLQUFLLEtBQzFCRixFQUFJRyxhQUFhLFNBQVVKLEdBQzNCQyxFQUFJRyxhQUFhLFNBQVVuRixHQUMzQmdGLEVBQUlJLE1BQU1DLE9BQVMsa0JBQ25CTCxFQUFJTSxpQkFBaUIsU0FBVUMsSUFDM0JQLEVBQUlRLFlBQWMsS0FDZlIsRUFBSVAsVUFBVUMsU0FBUyxZQUFpQyxLQUFuQk0sRUFBSVEsYUFBc0JSLEVBQUlQLFVBQVVDLFNBQVMsZUFBb0MsS0FBbkJNLEVBQUlRLGFBQXNCUixFQUFJUCxVQUFVQyxTQUFTLGNBQW1DLEtBQW5CTSxFQUFJUSxhQUFzQlIsRUFBSVAsVUFBVUMsU0FBUyxjQUFtQyxLQUFuQk0sRUFBSVEsYUFBc0JSLEVBQUlQLFVBQVVDLFNBQVMsWUFBaUMsS0FBbkJNLEVBQUlRLGVBQzNTQyxFQUFlLENBQUNGLEVBQUVHLE9BQU96RyxHQUFHc0csRUFBRUcsT0FBTzdCLFFBQVFDLEVBQUV5QixFQUFFRyxPQUFPN0IsUUFBUWMsSUFDaEVLLEVBQUlYLFVBQVksYUFBYXBGLEVBQUdpRyxNQUFNLEtBQUssZUFDM0NTLEtBRUpDLEdBQVcsSUFFZlosRUFBSU0saUJBQWlCLFNBQVVDLElBQzNCNUUsUUFBUUMsSUFBSSx5QkFDVG9FLEVBQUlQLFVBQVVDLFNBQVMsWUFBaUMsS0FBbkJNLEVBQUlRLGFBQXNCUixFQUFJUCxVQUFVQyxTQUFTLGVBQW9DLEtBQW5CTSxFQUFJUSxhQUFzQlIsRUFBSVAsVUFBVUMsU0FBUyxjQUFtQyxLQUFuQk0sRUFBSVEsYUFBc0JSLEVBQUlQLFVBQVVDLFNBQVMsY0FBbUMsS0FBbkJNLEVBQUlRLGFBQXNCUixFQUFJUCxVQUFVQyxTQUFTLFlBQWlDLEtBQW5CTSxFQUFJUSxlQUMzU0MsRUFBZSxDQUFDRixFQUFFRyxPQUFPekcsR0FBR3NHLEVBQUVHLE9BQU83QixRQUFRQyxFQUFFeUIsRUFBRUcsT0FBTzdCLFFBQVFjLElBQ2hFSyxFQUFJWCxVQUFZLGFBQWFwRixFQUFHaUcsTUFBTSxLQUFLLGVBQzNDUyxJQUNKLElBRUpkLEVBQU1nQixZQUFZYixFQUN0QixDQUNKLENBRUosQ0FHQSxTQUFTUyxFQUFlSyxHQUNwQixJQUFLN0csRUFBR2EsRUFBUStDLEdBQVdpRCxFQUMzQixPQUFPL0QsRUFBS1ksa0JBQWtCLENBQUMxRCxFQUFHYSxFQUFRK0MsR0FDOUMsQ0FFQSxTQUFTa0QsSUFDTCxJQUFJQyxFQUFxQnhDLFNBQVNzQixjQUFjLGlCQUM1QixJQUFoQmhELEdBQXdFLFlBQS9Da0UsRUFBbUJaLE1BQU0sbUJBSTdCLElBQWhCdEQsR0FBdUUsU0FBL0NrRSxFQUFtQlosTUFBTSxvQkFDdERZLEVBQW1CWixNQUFNLGtCQUFvQixXQUo3Q1ksRUFBbUJaLE1BQU0sa0JBQW9CLE1BT3JELENBRUEsU0FBU1EsSUFDTCxNQUFNSyxFQUFTekMsU0FBU3NCLGNBQWMsV0FDdEMsT0FBb0IsSUFBaEJoRCxHQUNBbkIsUUFBUUMsSUFBSSwyQ0FBNENrQixHQUN4RG1FLEVBQU9ULFlBQWMsZ0JBQ3JCTyxTQUNBakUsR0FBYyxLQUlkbkIsUUFBUUMsSUFBSSx3Q0FBeUNrQixHQUNyRG1FLEVBQU9ULFlBQWMsYUFDckJVLFlBQVcsSUF3Qm5CLFdBQ0ksSUFBSTVHLEVBQVlDLEtBQUtDLE1BQXNCLEdBQWhCRCxLQUFLRSxVQUM1QjBHLEVBQXNCM0MsU0FBU3NCLGNBQWMsaUJBQzdDc0IsRUFBY0QsRUFBb0JFLFNBQVMvRyxHQUMvQyxLQUFtQyxNQUE1QjhHLEVBQVlaLGFBQ2Y3RSxRQUFRQyxJQUFJLDREQUNadEIsRUFBWUMsS0FBS0MsTUFBc0IsSUFBaEJELEtBQUtFLFVBQzVCMkcsRUFBY0QsRUFBb0JFLFNBQVMvRyxHQUsvQyxPQUhBOEcsRUFBWVosWUFBYyxJQUMxQjFELEdBQWMsRUE1QmxCLFdBQ0ksSUFBSXFFLEVBQXNCM0MsU0FBU3NCLGNBQWMsaUJBQzdDd0IsRUFBaUJoRCxNQUFNQyxLQUFLNEMsRUFBb0JFLFVBQ3BEMUYsUUFBUUMsSUFBSSxxQ0FDWjBGLEVBQWUxQyxTQUFTMkMsS0FDaEJBLEVBQU05QixVQUFVQyxTQUFTLFlBQW1DLEtBQXJCNkIsRUFBTWYsYUFBc0JlLEVBQU05QixVQUFVQyxTQUFTLGVBQXNDLEtBQXJCNkIsRUFBTWYsYUFBc0JlLEVBQU05QixVQUFVQyxTQUFTLGNBQXFDLEtBQXJCNkIsRUFBTWYsYUFBc0JlLEVBQU05QixVQUFVQyxTQUFTLGNBQXFDLEtBQXJCNkIsRUFBTWYsYUFBc0JlLEVBQU05QixVQUFVQyxTQUFTLFlBQW1DLEtBQXJCNkIsRUFBTWYsZUFDaFU3RSxRQUFRQyxJQUFJLDRCQUNaNkUsRUFBZSxDQUFDYyxFQUFNdEgsR0FBR3NILEVBQU0xQyxRQUFRQyxFQUFFeUMsRUFBTTFDLFFBQVFjLElBQ3ZENEIsRUFBTWxDLFVBQVksYUFBYWtDLEVBQU10SCxHQUFHaUcsTUFBTSxLQUFLLGVBQ25EUyxJQUlKLEdBR1IsQ0FhSWEsR0FDT1osR0FDWCxDQXJDeUJhLElBQVUsVUFDM0JWLElBR1IsQ0FtQ0EsU0FBU0osSUFDTCxJQUFJTSxFQUFTekMsU0FBU3NCLGNBQWMsV0FDaEM0QixFQUFpQmxELFNBQVNzQixjQUFjLG1CQUN4Q3FCLEVBQXNCM0MsU0FBU3NCLGNBQWMsaUJBQzdDa0IsRUFBcUJ4QyxTQUFTc0IsY0FBYyxnQkFDNUM2QixFQUE4QlgsRUFBbUJLLFNBQ2pETyxFQUFpQjdFLEVBQUtFLGFBQWFGLEVBQUtyQixPQUFPcUIsRUFBS0MsUUFDakMsV0FBbkI0RSxHQVF3QixVQUFuQkEsS0FQTFgsRUFBT1QsWUFBYyxHQUNyQlMsRUFBT2IsTUFBTXlCLFFBQVUsT0FDdkJILEVBQWVsQixZQUFjLGVBQzdCVyxFQUFvQmYsTUFBTSxrQkFBb0IsT0FDOUNZLEVBQW1CWixNQUFNLGtCQUFvQixPQUM3Q3VCLEVBQTRCL0MsU0FBUzJDLEdBQVVBLEVBQU1uQixNQUFNLGtCQUFvQixVQVd2RixDQUNBUixFQUFZLEdBQUc3QyxFQUFLckIsT0FBT3pCLFlBQzNCMkYsRUFBWSxHQUFHN0MsRUFBS0MsTUFBTS9DLFlBQzFCK0QsRUFBYWpCLEVBQUtyQixPQUFPekIsR0FBRzhDLEVBQUtyQixPQUFPSCxhQUN4Q3lDLEVBQWFqQixFQUFLQyxNQUFNL0MsR0FBRzhDLEVBQUtDLE1BQU16QixhQUN0Q3FGLElBQ0E3RCxFQUFLVSxtQkFBbUJWLEVBQUtyQixPQUFPekIsR0FBRzZELEdBQ3ZDZixFQUFLVSxtQkFBbUJWLEVBQUtDLE1BQU0vQyxHQUFHOEQsRUFHMUMsQ0VsT0EsRSIsInNvdXJjZXMiOlsid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvbW9kdWxlcy9zaGlwLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvbW9kdWxlcy9ET00uanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9tb2R1bGVzL2dhbWVib2FyZC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IFNoaXAgPSAoaWQpID0+IHtcclxuICAgIGNvbnN0IGdlbmVyYXRlX3VuaXF1ZV9jb29yZGluYXRlcyA9IChjb3VudCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHNoaXAgPSBbXTtcclxuICAgICAgICB3aGlsZSAoc2hpcC5sZW5ndGggPCBjb3VudCl7XHJcbiAgICAgICAgICAgIGNvbnN0IHJhbmRvbU51bSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKVxyXG4gICAgICAgICAgICBpZiAoc2hpcC5pbmRleE9mKHJhbmRvbU51bSkgPT09IC0xKXtcclxuICAgICAgICAgICAgICAgIHNoaXAucHVzaChyYW5kb21OdW0pXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHNoaXBcclxuICAgIH1cclxuICAgIGxldCB1bmlxdWVfbnVtYmVycyA9IGdlbmVyYXRlX3VuaXF1ZV9jb29yZGluYXRlcyg1KTtcclxuICAgIGZ1bmN0aW9uIGdlbmVyYXRlX3NoaXBfY29vcmRpbmF0ZXMoeF9jb29yZCl7XHJcbiAgICAgICAgbGV0IHNoaXBfYXJyYXkgPSBbXTtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwOyBpKyspe1xyXG4gICAgICAgICAgICBzaGlwX2FycmF5LnB1c2goW3hfY29vcmQsaV0pXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gc2hpcF9hcnJheVxyXG4gICAgfVxyXG4gICAgZnVuY3Rpb24gY3JlYXRlX3NoaXBfcGllY2VzKCl7XHJcbiAgICAgICAgbGV0IGNhcnJpZXIgPSBnZW5lcmF0ZV9zaGlwX2Nvb3JkaW5hdGVzKHVuaXF1ZV9udW1iZXJzWzBdKTtcclxuICAgICAgICBsZXQgYmF0dGxlc2hpcCA9IGdlbmVyYXRlX3NoaXBfY29vcmRpbmF0ZXModW5pcXVlX251bWJlcnNbMV0pO1xyXG4gICAgICAgIGxldCBjcnVpc2VyID0gZ2VuZXJhdGVfc2hpcF9jb29yZGluYXRlcyh1bmlxdWVfbnVtYmVyc1syXSk7XHJcbiAgICAgICAgbGV0IHN1Ym1hcmluZSA9IGdlbmVyYXRlX3NoaXBfY29vcmRpbmF0ZXModW5pcXVlX251bWJlcnNbM10pO1xyXG4gICAgICAgIGxldCBkZXN0cm95ZXIgPSBnZW5lcmF0ZV9zaGlwX2Nvb3JkaW5hdGVzKHVuaXF1ZV9udW1iZXJzWzRdKTtcclxuICAgICAgICByZXR1cm4ge2NhcnJpZXIsYmF0dGxlc2hpcCxjcnVpc2VyLHN1Ym1hcmluZSxkZXN0cm95ZXJ9XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHNoaXBfcGllY2VzID0gY3JlYXRlX3NoaXBfcGllY2VzKCk7XHJcbiAgICBcclxuXHJcbiAgICBjb25zdCByZW1vdmVfcGllY2UgPSAoaWQscG9zaXRpb24pID0+IHtcclxuICAgICAgICBpZiAoc2hpcF9waWVjZXNbaWRdLmxlbmd0aCA8PSAxKXtcclxuICAgICAgICAgICAgcmV0dXJuIGlzU3VuayhpZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHBvc2l0aW9uX3JlZmVyZW5jZSA9IHNoaXBfcGllY2VzW2lkXS5maW5kSW5kZXgoKGNlbGwpID0+IEpTT04uc3RyaW5naWZ5KGNlbGwpID09IEpTT04uc3RyaW5naWZ5KHBvc2l0aW9uKSlcclxuICAgICAgICBjb25zb2xlLmxvZygnSGVyZSBpcyB0aGUgcG9zaXRpb24gcmVmZXJlbmNlLCAnLCBwb3NpdGlvbl9yZWZlcmVuY2UpXHJcbiAgICAgICAgc2hpcF9waWVjZXNbaWRdLnNwbGljZShwb3NpdGlvbl9yZWZlcmVuY2UsMSlcclxuICAgICAgICBjb25zb2xlLmxvZygnSGVyZSBpcyB0aGUgdXBkYXRlZCBzaGlwX3BpZWNlcyBhZnRlcndhcmRzOicsIHNoaXBfcGllY2VzKVxyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIFxyXG4gICAgY29uc3QgZ2V0X3NoaXBzID0gKCkgPT4ge1xyXG4gICAgICAgIHJldHVybiBzaGlwX3BpZWNlc1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGhpdCA9IChpZCxwb3NpdGlvbikgPT4ge1xyXG4gICAgICAgIGxldCBwbGF5ZXIgPSBpZDtcclxuICAgICAgICBjb25zb2xlLmxvZygnSGVyZSBpcyB0aGUgcGxheWVyIGZncm9tIGhpdCBmdW5jdGlvbicsIHBsYXllcilcclxuICAgICAgICBsZXQgW3NoaXBfbmFtZSwgc2hpcF9wb3NpdGlvbl0gPSBwbGF5ZXIuZ3JhYl9wb3NpdGlvbihwbGF5ZXIscG9zaXRpb24pXHJcbiAgICAgICAgaWYgKHNoaXBfbmFtZSA9PSBudWxsIHx8IHNoaXBfcG9zaXRpb24gPT0gbnVsbCl7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdEb2VzbnQgZXhpc3QhJylcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwbGF5ZXIucmVtb3ZlX3BpZWNlKHNoaXBfbmFtZSxzaGlwX3Bvc2l0aW9uKVxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGlzU3VuayA9IChzaGlwKSA9PiB7XHJcbiAgICAgICAgZGVsZXRlIHNoaXBfcGllY2VzW3NoaXBdO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGBTaGlwIGhhcyBiZWVuIGRlbGV0ZWQgc2luY2UgaXRzIGFycmF5IGlzIGVtcHR5LmApXHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGdyYWJfcG9zaXRpb24gPSAoaWQscG9zaXRpb24pID0+IHtcclxuICAgICAgICBsZXQgcGxheWVyID0gaWQ7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ0Zyb20gZ3JhYiBwb3NpdGlvbiBmdW5jdGlvbiwgdGhpcyBpcyB0aGUgcG9zaXRpb24gJywgcG9zaXRpb24pXHJcbiAgICAgICAgXHJcbiAgICAgICAgZm9yIChjb25zdCBwcm9wZXJ0eSBpbiBzaGlwX3BpZWNlcykge1xyXG4gICAgICAgICAgICBsZXQgb2JqZWN0X2FycmF5ID0gc2hpcF9waWVjZXNbcHJvcGVydHldXHJcbiAgICAgICAgICAgIGxldCBjb29yZHNfcmVzdWx0ID0gb2JqZWN0X2FycmF5LmZpbmQoKGNlbGwpID0+IEpTT04uc3RyaW5naWZ5KGNlbGwpID09IEpTT04uc3RyaW5naWZ5KHBvc2l0aW9uKSlcclxuICAgICAgICAgICAgaWYgKGNvb3Jkc19yZXN1bHQgIT0gdW5kZWZpbmVkKXtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGAke3BsYXllci5pZH0gd2FzIGhpdCFgKVxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0hlcmUgaXMgdGhlIHByb3BlcnR5OiAnLCBwcm9wZXJ0eSlcclxuICAgICAgICAgICAgICAgIHJldHVybiBbcHJvcGVydHksY29vcmRzX3Jlc3VsdF07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIFtudWxsLG51bGxdXHJcbiAgICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdXBkYXRlX3NoaXBfYXJyYXkgPSAoc2hpcF9waWVjZXNfZG9tKSA9PiB7XHJcbiAgICAgICAgc2hpcF9waWVjZXMgPSBudWxsO1xyXG4gICAgICAgIHJldHVybiBzaGlwX3BpZWNlcyA9IHNoaXBfcGllY2VzX2RvbTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4geyBpZCwgZ2V0X3NoaXBzLCBoaXQsIHJlbW92ZV9waWVjZSwgZ3JhYl9wb3NpdGlvbiwgdXBkYXRlX3NoaXBfYXJyYXkgfVxyXG59XHJcblxyXG5cclxuZXhwb3J0IGRlZmF1bHQgU2hpcDsiLCJpbXBvcnQgZ2FtZUJvYXJkIGZyb20gXCIuL2dhbWVib2FyZFwiIDtcclxuXHJcblxyXG5cclxuZnVuY3Rpb24gRE9NKCl7XHJcbiAgICBsZXQgcGxheWVyX3R1cm4gPSB0cnVlO1xyXG4gICAgY29uc3QgZ2FtZSA9IGdhbWVCb2FyZCgpO1xyXG4gICAgbGV0IHNoaXBfcGllY2VzX0RPTSA9IHt9XHJcbiAgICBsZXQgc2hpcF9waWVjZXNfRE9NX2JvdCA9IHt9XHJcbiAgICBmdW5jdGlvbiBjcmVhdGVfZ3JpZF9ib3hlcyhpZCl7XHJcbiAgICAgICAgY29uc3QgYm9hcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAuJHtpZH1gKVxyXG4gICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IDEwMDsgaSsrKXtcclxuICAgICAgICAgICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgIGRpdi5jbGFzc05hbWUgPSBgZ3JpZC1jZWxsLSR7aWR9YFxyXG4gICAgICAgICAgICBkaXYuaWQgPSBgJHtpfWBcclxuICAgICAgICAgICAgZGl2LnNldEF0dHJpYnV0ZSgnZGF0YS14JywgaSlcclxuICAgICAgICAgICAgZGl2LnNldEF0dHJpYnV0ZSgnZGF0YS15JywgaSsxKVxyXG4gICAgICAgICAgICBkaXYuc3R5bGUuYm9yZGVyID0gYDFweCBzb2xpZCBibGFja2BcclxuICAgICAgICAgICAgZGl2LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IGNvbnNvbGUubG9nKGUudGFyZ2V0KSlcclxuICAgICAgICAgICAgYm9hcmQuYXBwZW5kQ2hpbGQoZGl2KVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGZ1bmN0aW9uIHB1dF9pbl9zaGlwcyhwbGF5ZXJfaWQscGxheWVyX3NoaXBzX29iamVjdHMpe1xyXG4gICAgICAgIGxldCBwbGF5ZXJfc2hpcHMgPSBwbGF5ZXJfc2hpcHNfb2JqZWN0c1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGBUaGlzIGlzICR7cGxheWVyX2lkfSBzaGlwc2AsIHBsYXllcl9zaGlwcylcclxuICAgICAgICBjb25zb2xlLmxvZygnVGhpcyBpcyB0aGUgY2FycmllciBhcnJheTogJywgcGxheWVyX3NoaXBzWydjYXJyaWVyJ10pXHJcbiAgICAgICAgY29uc29sZS5sb2coJ1RoaXMgaXMgdGhlIGJhdHRsZXNoaXAgYXJyYXk6ICcsIHBsYXllcl9zaGlwc1snYmF0dGxlc2hpcCddKVxyXG4gICAgICAgIGNvbnNvbGUubG9nKCdUaGlzIGlzIHRoZSBjcnVpc2VyIGFycmF5OiAnLCBwbGF5ZXJfc2hpcHNbJ2NydWlzZXInXSlcclxuICAgICAgICBjb25zb2xlLmxvZygnVGhpcyBpcyB0aGUgc3VibWFyaW5lIGFycmF5OiAnLCBwbGF5ZXJfc2hpcHNbJ3N1Ym1hcmluZSddKVxyXG4gICAgICAgIGNvbnNvbGUubG9nKCdUaGlzIGlzIHRoZSBkZXN0cm95ZXIgYXJyYXk6ICcsIHBsYXllcl9zaGlwc1snZGVzdHJveWVyJ10pXHJcbiAgICAgICAgcmVuZGVyX3NoaXBfbmV3KHBsYXllcl9pZCwnY2FycmllcicsNSxwbGF5ZXJfc2hpcHNbJ2NhcnJpZXInXSlcclxuICAgICAgICByZW5kZXJfc2hpcF9uZXcocGxheWVyX2lkLCdiYXR0bGVzaGlwJyw0LHBsYXllcl9zaGlwc1snYmF0dGxlc2hpcCddKVxyXG4gICAgICAgIHJlbmRlcl9zaGlwX25ldyhwbGF5ZXJfaWQsJ2NydWlzZXInLDMscGxheWVyX3NoaXBzWydjcnVpc2VyJ10pXHJcbiAgICAgICAgcmVuZGVyX3NoaXBfbmV3KHBsYXllcl9pZCwnc3VibWFyaW5lJywzLHBsYXllcl9zaGlwc1snc3VibWFyaW5lJ10pXHJcbiAgICAgICAgcmVuZGVyX3NoaXBfbmV3KHBsYXllcl9pZCwnZGVzdHJveWVyJywyLHBsYXllcl9zaGlwc1snZGVzdHJveWVyJ10pXHJcbiAgICB9XHJcbiAgICBcclxuICAgIFxyXG4gICAgZnVuY3Rpb24gcmVuZGVyX3NoaXBfbmV3KHBsYXllcl9pZCxzaGlwX2lkLCBzaGlwX2xlbmd0aCwgc2hpcF9hcnJheSl7XHJcbiAgICAgICAgbGV0IHNoaXAgPSBzaGlwX2FycmF5XHJcbiAgICAgICAgY29uc3QgZ2FtZV9jZWxscyA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChgLmdyaWQtY2VsbC0ke3BsYXllcl9pZH0tYm9hcmRgKSk7XHJcbiAgICAgICAgbGV0IHhfY29vcmQgPSBzaGlwWzBdWzBdXHJcbiAgICAgICAgbGV0IHNwbGl0dGVkID0gcmVuZGVyX3NoaXBfcG9zaXRpb24oKVxyXG4gICAgICAgIGdhbWVfY2VsbHMuZm9yRWFjaCgoY2VsbCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyh4X2Nvb3JkID09IGNlbGwuZGF0YXNldC54KVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgbGV0IGZvdW5kX2FycmF5ID0gZ2FtZV9jZWxscy5maWx0ZXIoKGNlbGwpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIGNlbGwuZGF0YXNldC54ID09IHhfY29vcmRcclxuICAgICAgICB9KVxyXG4gICAgICAgIGNvbnNvbGUubG9nKGZvdW5kX2FycmF5KVxyXG4gICAgICAgIGxldCBoYWxmID0gTWF0aC5jZWlsKGZvdW5kX2FycmF5Lmxlbmd0aCAvIDIpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdUaGlzIGlzIGZvdW5kIGFycmF5IGJlZm9yZSBzcGxpdCcsIGZvdW5kX2FycmF5KVxyXG4gICAgICAgIGlmIChzcGxpdHRlZCA9PT0gMCl7XHJcbiAgICAgICAgICAgIGxldCBmaXJzdEhhbGYgPSBmb3VuZF9hcnJheS5zbGljZSgwLGhhbGYpXHJcbiAgICAgICAgICAgIC5zbGljZSgwLGhhbGYpXHJcbiAgICAgICAgICAgIC5zbGljZSgwLHNoaXBfbGVuZ3RoKVxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnVGhpcyBpcyB0aGUgZm91bmQgYXJyYXkgbm93IGZpcnN0IGhhbGYnLCBmaXJzdEhhbGYpXHJcbiAgICAgICAgICAgIGZpcnN0SGFsZi5mb3JFYWNoKChjZWxsKSA9PiBjZWxsLmNsYXNzTmFtZSA9IGBncmlkLWNlbGwtJHtwbGF5ZXJfaWR9LWJvYXJkICR7c2hpcF9pZH1gKVxyXG4gICAgICAgIH0gZWxzZXtcclxuICAgICAgICAgICAgbGV0IHNlY29uZEhhbGYgPSBmb3VuZF9hcnJheVxyXG4gICAgICAgICAgICAuc2xpY2UoaGFsZilcclxuICAgICAgICAgICAgLnNsaWNlKGAtJHtzaGlwX2xlbmd0aH1gKVxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnVGhpcyBpcyB0aGUgZm91bmQgYXJyYXkgbm93IHNlY29uZCBoYWxmJywgc2Vjb25kSGFsZilcclxuICAgICAgICAgICAgc2Vjb25kSGFsZi5mb3JFYWNoKChjZWxsKSA9PiBjZWxsLmNsYXNzTmFtZSA9IGBncmlkLWNlbGwtJHtwbGF5ZXJfaWR9LWJvYXJkICR7c2hpcF9pZH1gKSAgIFxyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zb2xlLmxvZygnR3JhYiBzaGlwIGNvb3JkcyBmdW5jdGlvbicsIGdyYWJfc2hpcF9jb29yZGluYXRlcyhwbGF5ZXJfaWQsYCR7c2hpcF9pZH1gKSlcclxuICAgICAgICBpZiAocGxheWVyX2lkID09PSBnYW1lLmFpYm90LmlkKXtcclxuICAgICAgICAgICAgc2hpcF9waWVjZXNfRE9NX2JvdFtgJHtzaGlwX2lkfWBdID0gZ3JhYl9zaGlwX2Nvb3JkaW5hdGVzKHBsYXllcl9pZCxgJHtzaGlwX2lkfWApXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdUaGlzIGlzIHRoZSBTSElQUyBmcm9tIGJvdCBET00gbm93Jywgc2hpcF9waWVjZXNfRE9NX2JvdClcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgc2hpcF9waWVjZXNfRE9NW2Ake3NoaXBfaWR9YF0gPSBncmFiX3NoaXBfY29vcmRpbmF0ZXMocGxheWVyX2lkLGAke3NoaXBfaWR9YClcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1RoaXMgaXMgdGhlIFNISVBTIGZyb20gRE9NIG5vdycsIHNoaXBfcGllY2VzX0RPTSlcclxuICAgICAgICB9ICBcclxuICAgIH1cclxuICAgIFxyXG4gICAgY29uc3QgcmVuZGVyX3NoaXBfcG9zaXRpb24gPSAoKSA9PiB7XHJcbiAgICAgICAgbGV0IG51bWJlciA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIpXHJcbiAgICAgICAgcmV0dXJuIG51bWJlclxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBjb25zdCBncmFiX3NoaXBfY29vcmRpbmF0ZXMgPSAocGxheWVyX2lkLHNoaXBfaWQpID0+e1xyXG4gICAgICAgIGxldCBjb29yZHNfYXJyYXkgPSBbXTtcclxuICAgICAgICBjb25zdCBnYW1lX2NlbGxzID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGAuZ3JpZC1jZWxsLSR7cGxheWVyX2lkfS1ib2FyZGApKTtcclxuICAgICAgICBnYW1lX2NlbGxzLmZvckVhY2goKGNlbGwpPT4ge1xyXG4gICAgICAgICAgICBpZiAoY2VsbC5jbGFzc0xpc3QuY29udGFpbnMoc2hpcF9pZCkpe1xyXG4gICAgICAgICAgICAgICAgY29vcmRzX2FycmF5LnB1c2goW2NlbGwuZGF0YXNldC54LGNlbGwuZGF0YXNldC55XSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgcmV0dXJuIGNvb3Jkc19hcnJheVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBSZW5kZXIgdGhlIGdyaWQgYm9hcmRzIGZvciBwbGF5ZXIgYW5kIEFJXHJcbiAgICBmdW5jdGlvbiBjcmVhdGVfZ3JpZChpZCl7XHJcbiAgICAgICAgY29uc3QgYm9hcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAuJHtpZH1gKVxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTA7IGkrKyl7XHJcbiAgICAgICAgICAgIGxldCByb3cgPSBpO1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwOyBpKyspe1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgICAgICBkaXYuY2xhc3NOYW1lID0gYGdyaWQtY2VsbC0ke2lkfWBcclxuICAgICAgICAgICAgICAgIGRpdi5pZCA9IGAke2lkLnNwbGl0KCctJylbMF19YFxyXG4gICAgICAgICAgICAgICAgZGl2LnNldEF0dHJpYnV0ZSgnZGF0YS14Jywgcm93KVxyXG4gICAgICAgICAgICAgICAgZGl2LnNldEF0dHJpYnV0ZSgnZGF0YS15JywgaSlcclxuICAgICAgICAgICAgICAgIGRpdi5zdHlsZS5ib3JkZXIgPSBgMXB4IHNvbGlkIGJsYWNrYFxyXG4gICAgICAgICAgICAgICAgZGl2LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBkaXYudGV4dENvbnRlbnQgPSBgWGA7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoZGl2LmNsYXNzTGlzdC5jb250YWlucygnY3J1aXNlcicpICYmIGRpdi50ZXh0Q29udGVudCA9PSAnWCcgfHwgZGl2LmNsYXNzTGlzdC5jb250YWlucygnYmF0dGxlc2hpcCcpICYmIGRpdi50ZXh0Q29udGVudCA9PSAnWCcgfHwgZGl2LmNsYXNzTGlzdC5jb250YWlucygnc3VibWFyaW5lJykgJiYgZGl2LnRleHRDb250ZW50ID09ICdYJyB8fCBkaXYuY2xhc3NMaXN0LmNvbnRhaW5zKCdkZXN0cm95ZXInKSAmJiBkaXYudGV4dENvbnRlbnQgPT0gJ1gnIHx8IGRpdi5jbGFzc0xpc3QuY29udGFpbnMoJ2NhcnJpZXInKSAmJiBkaXYudGV4dENvbnRlbnQgPT0gJ1gnKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWRkaGl0TGlzdGVuZXIoW2UudGFyZ2V0LmlkLGUudGFyZ2V0LmRhdGFzZXQueCxlLnRhcmdldC5kYXRhc2V0LnldKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGl2LmNsYXNzTmFtZSA9IGBncmlkLWNlbGwtJHtpZC5zcGxpdCgnLScpWzBdfS1ib2FyZCBoaXRgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlbmRlcl93aW5uZXIoKVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjaGVja190dXJuKClcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICBkaXYuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCAoZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdJbnB1dCBpcyBmaXJlZCBoZXJlIScpXHJcbiAgICAgICAgICAgICAgICAgICAgaWYoZGl2LmNsYXNzTGlzdC5jb250YWlucygnY3J1aXNlcicpICYmIGRpdi50ZXh0Q29udGVudCA9PSAnWCcgfHwgZGl2LmNsYXNzTGlzdC5jb250YWlucygnYmF0dGxlc2hpcCcpICYmIGRpdi50ZXh0Q29udGVudCA9PSAnWCcgfHwgZGl2LmNsYXNzTGlzdC5jb250YWlucygnc3VibWFyaW5lJykgJiYgZGl2LnRleHRDb250ZW50ID09ICdYJyB8fCBkaXYuY2xhc3NMaXN0LmNvbnRhaW5zKCdkZXN0cm95ZXInKSAmJiBkaXYudGV4dENvbnRlbnQgPT0gJ1gnIHx8IGRpdi5jbGFzc0xpc3QuY29udGFpbnMoJ2NhcnJpZXInKSAmJiBkaXYudGV4dENvbnRlbnQgPT0gJ1gnKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWRkaGl0TGlzdGVuZXIoW2UudGFyZ2V0LmlkLGUudGFyZ2V0LmRhdGFzZXQueCxlLnRhcmdldC5kYXRhc2V0LnldKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGl2LmNsYXNzTmFtZSA9IGBncmlkLWNlbGwtJHtpZC5zcGxpdCgnLScpWzBdfS1ib2FyZCBoaXRgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlbmRlcl93aW5uZXIoKVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICBib2FyZC5hcHBlbmRDaGlsZChkaXYpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIC8vRE9NIHJlbmRlciBoaXQgZnVuY3Rpb25cclxuICAgIGZ1bmN0aW9uIGFkZGhpdExpc3RlbmVyKGFycmF5KXtcclxuICAgICAgICBsZXQgW2lkLHhfY29vcmQseV9jb29yZF0gPSBhcnJheTtcclxuICAgICAgICByZXR1cm4gZ2FtZS5jaGVja19pZl9zaGlwX2hpdChbaWQseF9jb29yZCx5X2Nvb3JkXSlcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiByZW5kZXJfZ3JpZF90dXJucygpe1xyXG4gICAgICAgIGxldCBtYXN0ZXJfYWlib3RfYm9hcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYWlib3QtYm9hcmQnKVxyXG4gICAgICAgIGlmIChwbGF5ZXJfdHVybiA9PT0gZmFsc2UgJiYgbWFzdGVyX2FpYm90X2JvYXJkLnN0eWxlW1wicG9pbnRlci1ldmVudHNcIl0gPT09IFwidmlzaWJsZVwiKXtcclxuICAgICAgICAgICAgbWFzdGVyX2FpYm90X2JvYXJkLnN0eWxlW1wicG9pbnRlci1ldmVudHNcIl0gPSBcIm5vbmVcIjtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChwbGF5ZXJfdHVybiA9PT0gdHJ1ZSAmJiBtYXN0ZXJfYWlib3RfYm9hcmQuc3R5bGVbXCJwb2ludGVyLWV2ZW50c1wiXSA9PT0gXCJub25lXCIpe1xyXG4gICAgICAgICAgICBtYXN0ZXJfYWlib3RfYm9hcmQuc3R5bGVbXCJwb2ludGVyLWV2ZW50c1wiXSA9IFwidmlzaWJsZVwiO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGNoZWNrX3R1cm4oKXtcclxuICAgICAgICBjb25zdCB3aW5uZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcud2lubmVyJyk7XHJcbiAgICAgICAgaWYgKHBsYXllcl90dXJuID09PSB0cnVlKXtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1BMQVlFUlMgVFVSTiBTSU5DRSBUSElTIElTIFBMQVlFUiBUVVJOOiAnLCBwbGF5ZXJfdHVybilcclxuICAgICAgICAgICAgd2lubmVyLnRleHRDb250ZW50ID0gYFBsYXllcnMgdHVybiFgXHJcbiAgICAgICAgICAgIHJlbmRlcl9ncmlkX3R1cm5zKClcclxuICAgICAgICAgICAgcGxheWVyX3R1cm4gPSBmYWxzZTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNle1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnQk9UUyBUVVJOIFNJTkNFIFRISVMgSVMgUExBWUVSX1RVUk46ICcsIHBsYXllcl90dXJuKVxyXG4gICAgICAgICAgICB3aW5uZXIudGV4dENvbnRlbnQgPSBgQm90cyB0dXJuIWBcclxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiBib3RfaGl0KCksMTAwMClcclxuICAgICAgICAgICAgcmVuZGVyX2dyaWRfdHVybnMoKVxyXG4gICAgICAgICAgICByZXR1cm47IFxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiByZW5kZXJfYm90X2hpdCgpe1xyXG4gICAgICAgIGxldCBtYXN0ZXJfcGxheWVyX2JvYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBsYXllci1ib2FyZCcpO1xyXG4gICAgICAgIGxldCBjaGlsZHJlbl9jZWxscyA9IEFycmF5LmZyb20obWFzdGVyX3BsYXllcl9ib2FyZC5jaGlsZHJlbik7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ0V4ZWN1dGluZyByZW5kZXIgYm90IGhpdCBmdW5jdGlvbicpXHJcbiAgICAgICAgY2hpbGRyZW5fY2VsbHMuZm9yRWFjaCgoY2hpbGQpID0+IHtcclxuICAgICAgICAgICAgaWYgKGNoaWxkLmNsYXNzTGlzdC5jb250YWlucygnY3J1aXNlcicpICYmIGNoaWxkLnRleHRDb250ZW50ID09ICdYJyB8fCBjaGlsZC5jbGFzc0xpc3QuY29udGFpbnMoJ2JhdHRsZXNoaXAnKSAmJiBjaGlsZC50ZXh0Q29udGVudCA9PSAnWCcgfHwgY2hpbGQuY2xhc3NMaXN0LmNvbnRhaW5zKCdzdWJtYXJpbmUnKSAmJiBjaGlsZC50ZXh0Q29udGVudCA9PSAnWCcgfHwgY2hpbGQuY2xhc3NMaXN0LmNvbnRhaW5zKCdkZXN0cm95ZXInKSAmJiBjaGlsZC50ZXh0Q29udGVudCA9PSAnWCcgfHwgY2hpbGQuY2xhc3NMaXN0LmNvbnRhaW5zKCdjYXJyaWVyJykgJiYgY2hpbGQudGV4dENvbnRlbnQgPT0gJ1gnKXtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdCb3QgYWN0dWFsbHkgaGl0IGEgc2hpcCEnKVxyXG4gICAgICAgICAgICAgICAgYWRkaGl0TGlzdGVuZXIoW2NoaWxkLmlkLGNoaWxkLmRhdGFzZXQueCxjaGlsZC5kYXRhc2V0LnldKTtcclxuICAgICAgICAgICAgICAgIGNoaWxkLmNsYXNzTmFtZSA9IGBncmlkLWNlbGwtJHtjaGlsZC5pZC5zcGxpdCgnLScpWzBdfS1ib2FyZCBoaXRgXHJcbiAgICAgICAgICAgICAgICByZW5kZXJfd2lubmVyKClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNle1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuXHJcbiAgICB9ICAgXHJcblxyXG4gICAgZnVuY3Rpb24gYm90X2hpdCgpe1xyXG4gICAgICAgIGxldCByYW5kb21OdW0gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA5OSlcclxuICAgICAgICBsZXQgbWFzdGVyX3BsYXllcl9ib2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wbGF5ZXItYm9hcmQnKTtcclxuICAgICAgICBsZXQgcmFuZG9tX2NlbGwgPSBtYXN0ZXJfcGxheWVyX2JvYXJkLmNoaWxkcmVuW3JhbmRvbU51bV1cclxuICAgICAgICB3aGlsZSAocmFuZG9tX2NlbGwudGV4dENvbnRlbnQgPT09IFwiWFwiKXtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1Nwb3Qgd2FzIGFscmVhZHkgdGFrZW4uIFJldHJ5aW5nIGZvciBhbm90aGVyIGVtcHR5IGNlbGwuJylcclxuICAgICAgICAgICAgcmFuZG9tTnVtID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwKVxyXG4gICAgICAgICAgICByYW5kb21fY2VsbCA9IG1hc3Rlcl9wbGF5ZXJfYm9hcmQuY2hpbGRyZW5bcmFuZG9tTnVtXVxyXG4gICAgICAgIH1cclxuICAgICAgICByYW5kb21fY2VsbC50ZXh0Q29udGVudCA9ICdYJ1xyXG4gICAgICAgIHBsYXllcl90dXJuID0gdHJ1ZTtcclxuICAgICAgICByZW5kZXJfYm90X2hpdCgpXHJcbiAgICAgICAgcmV0dXJuIGNoZWNrX3R1cm4oKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiByZW5kZXJfd2lubmVyKCl7XHJcbiAgICAgICAgbGV0IHdpbm5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy53aW5uZXInKTtcclxuICAgICAgICBsZXQgZGVjbGFyZV93aW5uZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZGVjbGFyZS13aW5uZXInKTtcclxuICAgICAgICBsZXQgbWFzdGVyX3BsYXllcl9ib2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wbGF5ZXItYm9hcmQnKVxyXG4gICAgICAgIGxldCBtYXN0ZXJfYWlib3RfYm9hcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYWlib3QtYm9hcmQnKVxyXG4gICAgICAgIGxldCBtYXN0ZXJfYWlib3RfYm9hcmRfY2hpbGRyZW4gPSBtYXN0ZXJfYWlib3RfYm9hcmQuY2hpbGRyZW5cclxuICAgICAgICBsZXQgZGVjaWRlZF93aW5uZXIgPSBnYW1lLmNoZWNrX3dpbm5lcihnYW1lLnBsYXllcixnYW1lLmFpYm90KVxyXG4gICAgICAgIGlmIChkZWNpZGVkX3dpbm5lciA9PT0gJ3BsYXllcicpe1xyXG4gICAgICAgICAgICB3aW5uZXIudGV4dENvbnRlbnQgPSBcIlwiXHJcbiAgICAgICAgICAgIHdpbm5lci5zdHlsZS5kaXNwbGF5ID0gXCJmbGV4XCI7XHJcbiAgICAgICAgICAgIGRlY2xhcmVfd2lubmVyLnRleHRDb250ZW50ID0gXCJQbGF5ZXIgd2lucyFcIlxyXG4gICAgICAgICAgICBtYXN0ZXJfcGxheWVyX2JvYXJkLnN0eWxlW1wicG9pbnRlci1ldmVudHNcIl0gPSBcIm5vbmVcIjtcclxuICAgICAgICAgICAgbWFzdGVyX2FpYm90X2JvYXJkLnN0eWxlW1wicG9pbnRlci1ldmVudHNcIl0gPSBcIm5vbmVcIjtcclxuICAgICAgICAgICAgbWFzdGVyX2FpYm90X2JvYXJkX2NoaWxkcmVuLmZvckVhY2goKGNoaWxkKSA9PiBjaGlsZC5zdHlsZVtcInBvaW50ZXItZXZlbnRzXCJdID0gXCJub25lO1wiKVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChkZWNpZGVkX3dpbm5lciA9PT0gJ2FpYm90Jyl7XHJcbiAgICAgICAgICAgIHdpbm5lci50ZXh0Q29udGVudCA9IFwiXCJcclxuICAgICAgICAgICAgd2lubmVyLnN0eWxlLmRpc3BsYXkgPSBcImZsZXhcIjtcclxuICAgICAgICAgICAgZGVjbGFyZV93aW5uZXIudGV4dENvbnRlbnQgPSBcIlBsYXllciB3aW5zIVwiXHJcbiAgICAgICAgICAgIG1hc3Rlcl9wbGF5ZXJfYm9hcmQuc3R5bGVbXCJwb2ludGVyLWV2ZW50c1wiXSA9IFwibm9uZVwiO1xyXG4gICAgICAgICAgICBtYXN0ZXJfYWlib3RfYm9hcmQuc3R5bGVbXCJwb2ludGVyLWV2ZW50c1wiXSA9IFwibm9uZVwiO1xyXG4gICAgICAgICAgICBtYXN0ZXJfYWlib3RfYm9hcmRfY2hpbGRyZW4uZm9yRWFjaCgoY2hpbGQpID0+IGNoaWxkLnN0eWxlW1wicG9pbnRlci1ldmVudHNcIl0gPSBcIm5vbmU7XCIpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNyZWF0ZV9ncmlkKGAke2dhbWUucGxheWVyLmlkfS1ib2FyZGApO1xyXG4gICAgY3JlYXRlX2dyaWQoYCR7Z2FtZS5haWJvdC5pZH0tYm9hcmRgKTtcclxuICAgIHB1dF9pbl9zaGlwcyhnYW1lLnBsYXllci5pZCxnYW1lLnBsYXllci5nZXRfc2hpcHMoKSk7XHJcbiAgICBwdXRfaW5fc2hpcHMoZ2FtZS5haWJvdC5pZCxnYW1lLmFpYm90LmdldF9zaGlwcygpKTtcclxuICAgIGNoZWNrX3R1cm4oKVxyXG4gICAgZ2FtZS51cGRhdGVfY29vcmRpbmF0ZXMoZ2FtZS5wbGF5ZXIuaWQsc2hpcF9waWVjZXNfRE9NKVxyXG4gICAgZ2FtZS51cGRhdGVfY29vcmRpbmF0ZXMoZ2FtZS5haWJvdC5pZCxzaGlwX3BpZWNlc19ET01fYm90KVxyXG5cclxuICAgIHJldHVybiB7IGNyZWF0ZV9ncmlkX2JveGVzLCBjcmVhdGVfZ3JpZCwgcHV0X2luX3NoaXBzIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgRE9NO1xyXG5cclxuIiwiaW1wb3J0IFNoaXAgZnJvbSBcIi4vc2hpcC5qc1wiO1xyXG5cclxuY29uc3QgZ2FtZUJvYXJkID0gKCkgPT4ge1xyXG4gICAgbGV0IHBsYXllciA9IFNoaXAoJ3BsYXllcicpXHJcbiAgICBsZXQgYWlib3QgPSBTaGlwKCdhaWJvdCcpXHJcbiAgICBmdW5jdGlvbiB1cGRhdGVfY29vcmRpbmF0ZXMocGxheWVyX2lkLHNoaXBfZG9tX3BpZWNlcyl7XHJcbiAgICAgICAgaWYgKHBsYXllcl9pZCA9PT0gcGxheWVyLmlkKXtcclxuICAgICAgICAgICAgcGxheWVyLnVwZGF0ZV9zaGlwX2FycmF5KHNoaXBfZG9tX3BpZWNlcylcclxuICAgICAgICB9IGVsc2V7XHJcbiAgICAgICAgICAgIGFpYm90LnVwZGF0ZV9zaGlwX2FycmF5KHNoaXBfZG9tX3BpZWNlcylcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gY2hlY2tfaWZfc2hpcF9oaXQoY29vcmRzKXtcclxuICAgICAgICBsZXQgW2lkLHhfY29vcmQseV9jb29yZF0gPSBjb29yZHNcclxuICAgICAgICBjb25zb2xlLmxvZygnSEVSRSBJUyBUSEUgSUQgJywgaWQpXHJcbiAgICAgICAgY29uc29sZS5sb2coJ0hFUkUgSVMgVEhFIHggJywgeF9jb29yZClcclxuICAgICAgICBjb25zb2xlLmxvZygnSEVSRSBJUyBUSEUgeSAnLCB5X2Nvb3JkKVxyXG4gICAgICAgIGlmIChpZCA9PT0gcGxheWVyLmlkKXtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1BsYXllciBjZWxsIHdhcyBjbGlja2VkIG9uLicpXHJcbiAgICAgICAgICAgIGFpYm90LmhpdChwbGF5ZXIsW3hfY29vcmQseV9jb29yZF0pXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdQbGF5ZXIgc2hpcHMgYWZ0ZXIgZXZlcnl0aGluZyB3YXMgdXBkYXRlZC9kZWxldGVkJywgcGxheWVyLmdldF9zaGlwcygpKVxyXG4gICAgICAgIH0gZWxzZSBpZiAoaWQgPT09IGFpYm90LmlkKXtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ0FpIGJvdCBjZWxsIHdhcyBjbGlja2VkIG9uLicpXHJcbiAgICAgICAgICAgIHBsYXllci5oaXQoYWlib3QsIFt4X2Nvb3JkLHlfY29vcmRdKVxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnQUkgYm90IHNoaXBzIGFmdGVyIGV2ZXJ5dGhpbmcgd2FzIHVwZGF0ZWQvZGVsZXRlZCcsIGFpYm90LmdldF9zaGlwcygpKVxyXG4gICAgICAgIH1cclxuICAgICAgICBjaGVja193aW5uZXIocGxheWVyLGFpYm90KVxyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgICBcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBjaGVja193aW5uZXIocGxheWVyX2lkLGJvdF9pZCl7XHJcbiAgICAgICAgY29uc3QgcGxheWVyID0gcGxheWVyX2lkO1xyXG4gICAgICAgIGNvbnN0IGJvdCA9IGJvdF9pZFxyXG4gICAgICAgIGxldCBwbGF5ZXJfc2hpcHMgPSBwbGF5ZXIuZ2V0X3NoaXBzKClcclxuICAgICAgICBsZXQgYm90X3NoaXBzID0gYm90LmdldF9zaGlwcygpXHJcbiAgICAgICAgbGV0IHBsYXllcl9jb3VudGVyID0gMDtcclxuICAgICAgICBsZXQgYm90X2NvdW50ZXIgPSAwO1xyXG4gICAgICAgIGZvciAoY29uc3QgcHJvcGVydHkgaW4gcGxheWVyX3NoaXBzKXtcclxuICAgICAgICAgICAgaWYocHJvcGVydHkpe1xyXG4gICAgICAgICAgICAgICAgcGxheWVyX2NvdW50ZXIrK1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAoY29uc3QgcHJvcGVydHkgaW4gYm90X3NoaXBzKXtcclxuICAgICAgICAgICAgaWYocHJvcGVydHkpe1xyXG4gICAgICAgICAgICAgICAgYm90X2NvdW50ZXIrK1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChwbGF5ZXJfY291bnRlciA8IDEgJiYgYm90X2NvdW50ZXIgPiAxICl7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBXZSBoYXZlIGEgd2lubmVyLiBJdHMgJHtib3QuaWR9YClcclxuICAgICAgICAgICAgcmV0dXJuIGJvdC5pZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHBsYXllcl9jb3VudGVyID4gMSAmJiBib3RfY291bnRlciA8IDEgKXtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coYFdlIGhhdmUgYSB3aW5uZXIuIEl0cyAke3BsYXllci5pZH1gKVxyXG4gICAgICAgICAgICByZXR1cm4gcGxheWVyLmlkO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHJldHVybiB7ICBwbGF5ZXIsIGFpYm90LCB1cGRhdGVfY29vcmRpbmF0ZXMsIGNoZWNrX2lmX3NoaXBfaGl0LCBjaGVja193aW5uZXIgIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgZ2FtZUJvYXJkOyIsImltcG9ydCBET00gZnJvbSBcIi4vbW9kdWxlcy9ET01cIjtcclxuXHJcblxyXG5cclxuXHJcbkRPTSgpO1xyXG5cclxuIl0sIm5hbWVzIjpbImlkIiwidW5pcXVlX251bWJlcnMiLCJjb3VudCIsInNoaXAiLCJsZW5ndGgiLCJyYW5kb21OdW0iLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJpbmRleE9mIiwicHVzaCIsImdlbmVyYXRlX3VuaXF1ZV9jb29yZGluYXRlcyIsImdlbmVyYXRlX3NoaXBfY29vcmRpbmF0ZXMiLCJ4X2Nvb3JkIiwic2hpcF9hcnJheSIsImkiLCJzaGlwX3BpZWNlcyIsImNhcnJpZXIiLCJiYXR0bGVzaGlwIiwiY3J1aXNlciIsInN1Ym1hcmluZSIsImRlc3Ryb3llciIsImdldF9zaGlwcyIsImhpdCIsInBvc2l0aW9uIiwicGxheWVyIiwiY29uc29sZSIsImxvZyIsInNoaXBfbmFtZSIsInNoaXBfcG9zaXRpb24iLCJncmFiX3Bvc2l0aW9uIiwicmVtb3ZlX3BpZWNlIiwiaXNTdW5rIiwicG9zaXRpb25fcmVmZXJlbmNlIiwiZmluZEluZGV4IiwiY2VsbCIsIkpTT04iLCJzdHJpbmdpZnkiLCJzcGxpY2UiLCJwcm9wZXJ0eSIsImNvb3Jkc19yZXN1bHQiLCJmaW5kIiwidW5kZWZpbmVkIiwidXBkYXRlX3NoaXBfYXJyYXkiLCJzaGlwX3BpZWNlc19kb20iLCJwbGF5ZXJfdHVybiIsImdhbWUiLCJhaWJvdCIsImNoZWNrX3dpbm5lciIsInBsYXllcl9pZCIsImJvdF9pZCIsImJvdCIsInBsYXllcl9zaGlwcyIsImJvdF9zaGlwcyIsInBsYXllcl9jb3VudGVyIiwiYm90X2NvdW50ZXIiLCJ1cGRhdGVfY29vcmRpbmF0ZXMiLCJzaGlwX2RvbV9waWVjZXMiLCJjaGVja19pZl9zaGlwX2hpdCIsImNvb3JkcyIsInlfY29vcmQiLCJzaGlwX3BpZWNlc19ET00iLCJzaGlwX3BpZWNlc19ET01fYm90IiwicHV0X2luX3NoaXBzIiwicGxheWVyX3NoaXBzX29iamVjdHMiLCJyZW5kZXJfc2hpcF9uZXciLCJzaGlwX2lkIiwic2hpcF9sZW5ndGgiLCJnYW1lX2NlbGxzIiwiQXJyYXkiLCJmcm9tIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwic3BsaXR0ZWQiLCJyZW5kZXJfc2hpcF9wb3NpdGlvbiIsImZvckVhY2giLCJkYXRhc2V0IiwieCIsImZvdW5kX2FycmF5IiwiZmlsdGVyIiwiaGFsZiIsImNlaWwiLCJmaXJzdEhhbGYiLCJzbGljZSIsImNsYXNzTmFtZSIsInNlY29uZEhhbGYiLCJncmFiX3NoaXBfY29vcmRpbmF0ZXMiLCJjb29yZHNfYXJyYXkiLCJjbGFzc0xpc3QiLCJjb250YWlucyIsInkiLCJjcmVhdGVfZ3JpZCIsImJvYXJkIiwicXVlcnlTZWxlY3RvciIsInJvdyIsImRpdiIsImNyZWF0ZUVsZW1lbnQiLCJzcGxpdCIsInNldEF0dHJpYnV0ZSIsInN0eWxlIiwiYm9yZGVyIiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJ0ZXh0Q29udGVudCIsImFkZGhpdExpc3RlbmVyIiwidGFyZ2V0IiwicmVuZGVyX3dpbm5lciIsImNoZWNrX3R1cm4iLCJhcHBlbmRDaGlsZCIsImFycmF5IiwicmVuZGVyX2dyaWRfdHVybnMiLCJtYXN0ZXJfYWlib3RfYm9hcmQiLCJ3aW5uZXIiLCJzZXRUaW1lb3V0IiwibWFzdGVyX3BsYXllcl9ib2FyZCIsInJhbmRvbV9jZWxsIiwiY2hpbGRyZW4iLCJjaGlsZHJlbl9jZWxscyIsImNoaWxkIiwicmVuZGVyX2JvdF9oaXQiLCJib3RfaGl0IiwiZGVjbGFyZV93aW5uZXIiLCJtYXN0ZXJfYWlib3RfYm9hcmRfY2hpbGRyZW4iLCJkZWNpZGVkX3dpbm5lciIsImRpc3BsYXkiXSwic291cmNlUm9vdCI6IiJ9