(()=>{"use strict";const e=e=>{let t=(e=>{const t=[];for(;t.length<5;){const e=Math.floor(10*Math.random());-1===t.indexOf(e)&&t.push(e)}return t})();function o(e){let t=[];for(let o=0;o<10;o++)t.push([e,o]);return t}let r={carrier:o(t[0]),battleship:o(t[1]),cruiser:o(t[2]),submarine:o(t[3]),destroyer:o(t[4])};return{id:e,get_ships:()=>r,hit:(e,t)=>{let o=e;console.log("Here is the player fgrom hit function",o);let[r,s]=o.grab_position(o,t);return null==r||null==s?(console.log("Doesnt exist!"),!1):(o.remove_piece(r,s),!0)},remove_piece:(e,t)=>{if(r[e].length<=1)return(e=>{delete r[e],console.log("Ship has been deleted since its array is empty.")})(e);const o=r[e].find((e=>JSON.stringify(e)==JSON.stringify(t)));console.log("Here is the position reference, ",o),r[e].splice(o,1),console.log("Here is the updated ship_pieces afterwards:",r)},grab_position:(e,t)=>{let o=e;console.log("From grab position function, this is the position ",t);for(const e in r){let s=r[e].find((e=>JSON.stringify(e)==JSON.stringify(t)));if(null!=s)return console.log(`${o.id} was hit!`),console.log("Here is the property: ",e),[e,s]}return[null,null]},update_ship_array:e=>(r=null,r=e)}};!function(){const t=(()=>{let t=e("player"),o=e("aibot");return{player:t,aibot:o,update_coordinates:function(e,r){e===t.id?t.update_ship_array(r):o.update_ship_array(r)},check_if_ship_hit:function(e){let[r,s,i]=e;console.log("HERE IS THE ID ",r),console.log("HERE IS THE x ",s),console.log("HERE IS THE y ",i),r===t.id?(console.log("Player cell was clicked on."),o.hit(t,[s,i]),console.log("Player ships after everything was updated/deleted",t.get_ships())):r===o.id&&(console.log("Ai bot cell was clicked on."),t.hit(o,[s,i]),console.log("AI bot ships after everything was updated/deleted",o.get_ships()))}}})();let o={},r={};function s(e,t){let o=t;console.log(`This is ${e} ships`,o),console.log("This is the carrier array: ",o.carrier),console.log("This is the battleship array: ",o.battleship),console.log("This is the cruiser array: ",o.cruiser),console.log("This is the submarine array: ",o.submarine),console.log("This is the destroyer array: ",o.destroyer),i(e,"carrier",5,o.carrier),i(e,"battleship",4,o.battleship),i(e,"cruiser",3,o.cruiser),i(e,"submarine",3,o.submarine),i(e,"destroyer",2,o.destroyer)}function i(e,s,i,n){let c=n;const d=Array.from(document.querySelectorAll(`.grid-cell-${e}-board`));let h=c[0][0],u=l();d.forEach((e=>{console.log(h==e.dataset.x)}));let p=d.filter((e=>e.dataset.x==h));console.log(p);let g=Math.ceil(p.length/2);if(console.log("This is found array before split",p),0===u){let t=p.slice(0,g).slice(0,g).slice(0,i);console.log("This is the found array now first half",t),t.forEach((t=>t.className=`grid-cell-${e}-board ${s}`))}else{let t=p.slice(g).slice(`-${i}`);console.log("This is the found array now second half",t),t.forEach((t=>t.className=`grid-cell-${e}-board ${s}`))}console.log("Grab ship coords function",a(e,`${s}`)),e===t.aibot.id?(r[`${s}`]=a(e,`${s}`),console.log("This is the SHIPS from bot DOM now",r)):(o[`${s}`]=a(e,`${s}`),console.log("This is the SHIPS from DOM now",o))}const l=()=>Math.floor(2*Math.random()),a=(e,t)=>{let o=[];return Array.from(document.querySelectorAll(`.grid-cell-${e}-board`)).forEach((e=>{e.classList.contains(t)&&o.push([e.dataset.x,e.dataset.y])})),o};function n(e){const t=document.querySelector(`.${e}`);for(let o=0;o<10;o++){let r=o;for(let o=0;o<10;o++){const s=document.createElement("div");s.className=`grid-cell-${e}`,s.id=`${e.split("-")[0]}`,s.setAttribute("data-x",r),s.setAttribute("data-y",o),s.style.border="1px solid black",s.addEventListener("click",(t=>{s.textContent="X",c([t.target.id,t.target.dataset.x,t.target.dataset.y]),render_hits(e)})),t.appendChild(s)}}}function c(e){let[o,r,s]=e;return t.check_if_ship_hit([o,r,s])}n(`${t.player.id}-board`),n(`${t.aibot.id}-board`),s(t.player.id,t.player.get_ships()),s(t.aibot.id,t.aibot.get_ships()),t.update_coordinates(t.player.id,o),t.update_coordinates(t.aibot.id,r)}()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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L2JhdHRsZXNoaXAvLi9zcmMvbW9kdWxlcy9zaGlwLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvbW9kdWxlcy9ET00uanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9tb2R1bGVzL2dhbWVib2FyZC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IFNoaXAgPSAoaWQpID0+IHtcclxuICAgIGNvbnN0IGdlbmVyYXRlX3VuaXF1ZV9jb29yZGluYXRlcyA9IChjb3VudCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHNoaXAgPSBbXTtcclxuICAgICAgICB3aGlsZSAoc2hpcC5sZW5ndGggPCBjb3VudCl7XHJcbiAgICAgICAgICAgIGNvbnN0IHJhbmRvbU51bSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKVxyXG4gICAgICAgICAgICBpZiAoc2hpcC5pbmRleE9mKHJhbmRvbU51bSkgPT09IC0xKXtcclxuICAgICAgICAgICAgICAgIHNoaXAucHVzaChyYW5kb21OdW0pXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHNoaXBcclxuICAgIH1cclxuICAgIGxldCB1bmlxdWVfbnVtYmVycyA9IGdlbmVyYXRlX3VuaXF1ZV9jb29yZGluYXRlcyg1KTtcclxuICAgIGZ1bmN0aW9uIGdlbmVyYXRlX3NoaXBfY29vcmRpbmF0ZXMoeF9jb29yZCl7XHJcbiAgICAgICAgbGV0IHNoaXBfYXJyYXkgPSBbXTtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwOyBpKyspe1xyXG4gICAgICAgICAgICBzaGlwX2FycmF5LnB1c2goW3hfY29vcmQsaV0pXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gc2hpcF9hcnJheVxyXG4gICAgfVxyXG4gICAgZnVuY3Rpb24gY3JlYXRlX3NoaXBfcGllY2VzKCl7XHJcbiAgICAgICAgbGV0IGNhcnJpZXIgPSBnZW5lcmF0ZV9zaGlwX2Nvb3JkaW5hdGVzKHVuaXF1ZV9udW1iZXJzWzBdKTtcclxuICAgICAgICBsZXQgYmF0dGxlc2hpcCA9IGdlbmVyYXRlX3NoaXBfY29vcmRpbmF0ZXModW5pcXVlX251bWJlcnNbMV0pO1xyXG4gICAgICAgIGxldCBjcnVpc2VyID0gZ2VuZXJhdGVfc2hpcF9jb29yZGluYXRlcyh1bmlxdWVfbnVtYmVyc1syXSk7XHJcbiAgICAgICAgbGV0IHN1Ym1hcmluZSA9IGdlbmVyYXRlX3NoaXBfY29vcmRpbmF0ZXModW5pcXVlX251bWJlcnNbM10pO1xyXG4gICAgICAgIGxldCBkZXN0cm95ZXIgPSBnZW5lcmF0ZV9zaGlwX2Nvb3JkaW5hdGVzKHVuaXF1ZV9udW1iZXJzWzRdKTtcclxuICAgICAgICByZXR1cm4ge2NhcnJpZXIsYmF0dGxlc2hpcCxjcnVpc2VyLHN1Ym1hcmluZSxkZXN0cm95ZXJ9XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHNoaXBfcGllY2VzID0gY3JlYXRlX3NoaXBfcGllY2VzKCk7XHJcbiAgICBcclxuXHJcbiAgICBjb25zdCByZW1vdmVfcGllY2UgPSAoaWQscG9zaXRpb24pID0+IHtcclxuICAgICAgICBpZiAoc2hpcF9waWVjZXNbaWRdLmxlbmd0aCA8PSAxKXtcclxuICAgICAgICAgICAgcmV0dXJuIGlzU3VuayhpZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHBvc2l0aW9uX3JlZmVyZW5jZSA9IHNoaXBfcGllY2VzW2lkXS5maW5kKChjZWxsKSA9PiBKU09OLnN0cmluZ2lmeShjZWxsKSA9PSBKU09OLnN0cmluZ2lmeShwb3NpdGlvbikpXHJcbiAgICAgICAgY29uc29sZS5sb2coJ0hlcmUgaXMgdGhlIHBvc2l0aW9uIHJlZmVyZW5jZSwgJywgcG9zaXRpb25fcmVmZXJlbmNlKVxyXG4gICAgICAgIHNoaXBfcGllY2VzW2lkXS5zcGxpY2UocG9zaXRpb25fcmVmZXJlbmNlLDEpXHJcbiAgICAgICAgY29uc29sZS5sb2coJ0hlcmUgaXMgdGhlIHVwZGF0ZWQgc2hpcF9waWVjZXMgYWZ0ZXJ3YXJkczonLCBzaGlwX3BpZWNlcylcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZ2V0X3NoaXBzID0gKCkgPT4ge1xyXG4gICAgICAgIHJldHVybiBzaGlwX3BpZWNlc1xyXG4gICAgfVxyXG5cclxuICAgIFxyXG5cclxuICAgIGNvbnN0IGhpdCA9IChpZCxwb3NpdGlvbikgPT4ge1xyXG4gICAgICAgIGxldCBwbGF5ZXIgPSBpZDtcclxuICAgICAgICBjb25zb2xlLmxvZygnSGVyZSBpcyB0aGUgcGxheWVyIGZncm9tIGhpdCBmdW5jdGlvbicsIHBsYXllcilcclxuICAgICAgICBsZXQgW3NoaXBfbmFtZSwgc2hpcF9wb3NpdGlvbl0gPSBwbGF5ZXIuZ3JhYl9wb3NpdGlvbihwbGF5ZXIscG9zaXRpb24pXHJcbiAgICAgICAgaWYgKHNoaXBfbmFtZSA9PSBudWxsIHx8IHNoaXBfcG9zaXRpb24gPT0gbnVsbCl7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdEb2VzbnQgZXhpc3QhJylcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwbGF5ZXIucmVtb3ZlX3BpZWNlKHNoaXBfbmFtZSxzaGlwX3Bvc2l0aW9uKVxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBpc1N1bmsgPSAoc2hpcCkgPT4ge1xyXG4gICAgICAgIGRlbGV0ZSBzaGlwX3BpZWNlc1tzaGlwXTtcclxuICAgICAgICBjb25zb2xlLmxvZyhgU2hpcCBoYXMgYmVlbiBkZWxldGVkIHNpbmNlIGl0cyBhcnJheSBpcyBlbXB0eS5gKVxyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBncmFiX3Bvc2l0aW9uID0gKGlkLHBvc2l0aW9uKSA9PiB7XHJcbiAgICAgICAgbGV0IHBsYXllciA9IGlkO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdGcm9tIGdyYWIgcG9zaXRpb24gZnVuY3Rpb24sIHRoaXMgaXMgdGhlIHBvc2l0aW9uICcsIHBvc2l0aW9uKVxyXG4gICAgICAgIFxyXG4gICAgICAgIGZvciAoY29uc3QgcHJvcGVydHkgaW4gc2hpcF9waWVjZXMpIHtcclxuICAgICAgICAgICAgbGV0IG9iamVjdF9hcnJheSA9IHNoaXBfcGllY2VzW3Byb3BlcnR5XVxyXG4gICAgICAgICAgICBsZXQgY29vcmRzX3Jlc3VsdCA9IG9iamVjdF9hcnJheS5maW5kKChjZWxsKSA9PiBKU09OLnN0cmluZ2lmeShjZWxsKSA9PSBKU09OLnN0cmluZ2lmeShwb3NpdGlvbikpXHJcbiAgICAgICAgICAgIGlmIChjb29yZHNfcmVzdWx0ICE9IHVuZGVmaW5lZCl7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgJHtwbGF5ZXIuaWR9IHdhcyBoaXQhYClcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdIZXJlIGlzIHRoZSBwcm9wZXJ0eTogJywgcHJvcGVydHkpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gW3Byb3BlcnR5LGNvb3Jkc19yZXN1bHRdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBbbnVsbCxudWxsXVxyXG4gICAgICAgIFxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHVwZGF0ZV9zaGlwX2FycmF5ID0gKHNoaXBfcGllY2VzX2RvbSkgPT4ge1xyXG4gICAgICAgIHNoaXBfcGllY2VzID0gbnVsbDtcclxuICAgICAgICByZXR1cm4gc2hpcF9waWVjZXMgPSBzaGlwX3BpZWNlc19kb207XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsgaWQsIGdldF9zaGlwcywgaGl0LCByZW1vdmVfcGllY2UsIGdyYWJfcG9zaXRpb24sIHVwZGF0ZV9zaGlwX2FycmF5IH1cclxufVxyXG5cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFNoaXA7IiwiaW1wb3J0IGdhbWVCb2FyZCBmcm9tIFwiLi9nYW1lYm9hcmRcIiA7XHJcblxyXG5cclxuXHJcbmZ1bmN0aW9uIERPTSgpe1xyXG4gICAgY29uc3QgZ2FtZSA9IGdhbWVCb2FyZCgpO1xyXG4gICAgbGV0IHNoaXBfcGllY2VzX0RPTSA9IHt9XHJcbiAgICBsZXQgc2hpcF9waWVjZXNfRE9NX2JvdCA9IHt9XHJcbiAgICBmdW5jdGlvbiBjcmVhdGVfZ3JpZF9ib3hlcyhpZCl7XHJcbiAgICAgICAgY29uc3QgYm9hcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAuJHtpZH1gKVxyXG4gICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IDEwMDsgaSsrKXtcclxuICAgICAgICAgICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgIGRpdi5jbGFzc05hbWUgPSBgZ3JpZC1jZWxsLSR7aWR9YFxyXG4gICAgICAgICAgICBkaXYuaWQgPSBgJHtpfWBcclxuICAgICAgICAgICAgZGl2LnNldEF0dHJpYnV0ZSgnZGF0YS14JywgaSlcclxuICAgICAgICAgICAgZGl2LnNldEF0dHJpYnV0ZSgnZGF0YS15JywgaSsxKVxyXG4gICAgICAgICAgICBkaXYuc3R5bGUuYm9yZGVyID0gYDFweCBzb2xpZCBibGFja2BcclxuICAgICAgICAgICAgZGl2LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IGNvbnNvbGUubG9nKGUudGFyZ2V0KSlcclxuICAgICAgICAgICAgYm9hcmQuYXBwZW5kQ2hpbGQoZGl2KVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGZ1bmN0aW9uIHB1dF9pbl9zaGlwcyhwbGF5ZXJfaWQscGxheWVyX3NoaXBzX29iamVjdHMpe1xyXG4gICAgICAgIGxldCBwbGF5ZXJfc2hpcHMgPSBwbGF5ZXJfc2hpcHNfb2JqZWN0c1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGBUaGlzIGlzICR7cGxheWVyX2lkfSBzaGlwc2AsIHBsYXllcl9zaGlwcylcclxuICAgICAgICBjb25zb2xlLmxvZygnVGhpcyBpcyB0aGUgY2FycmllciBhcnJheTogJywgcGxheWVyX3NoaXBzWydjYXJyaWVyJ10pXHJcbiAgICAgICAgY29uc29sZS5sb2coJ1RoaXMgaXMgdGhlIGJhdHRsZXNoaXAgYXJyYXk6ICcsIHBsYXllcl9zaGlwc1snYmF0dGxlc2hpcCddKVxyXG4gICAgICAgIGNvbnNvbGUubG9nKCdUaGlzIGlzIHRoZSBjcnVpc2VyIGFycmF5OiAnLCBwbGF5ZXJfc2hpcHNbJ2NydWlzZXInXSlcclxuICAgICAgICBjb25zb2xlLmxvZygnVGhpcyBpcyB0aGUgc3VibWFyaW5lIGFycmF5OiAnLCBwbGF5ZXJfc2hpcHNbJ3N1Ym1hcmluZSddKVxyXG4gICAgICAgIGNvbnNvbGUubG9nKCdUaGlzIGlzIHRoZSBkZXN0cm95ZXIgYXJyYXk6ICcsIHBsYXllcl9zaGlwc1snZGVzdHJveWVyJ10pXHJcbiAgICAgICAgcmVuZGVyX3NoaXBfbmV3KHBsYXllcl9pZCwnY2FycmllcicsNSxwbGF5ZXJfc2hpcHNbJ2NhcnJpZXInXSlcclxuICAgICAgICByZW5kZXJfc2hpcF9uZXcocGxheWVyX2lkLCdiYXR0bGVzaGlwJyw0LHBsYXllcl9zaGlwc1snYmF0dGxlc2hpcCddKVxyXG4gICAgICAgIHJlbmRlcl9zaGlwX25ldyhwbGF5ZXJfaWQsJ2NydWlzZXInLDMscGxheWVyX3NoaXBzWydjcnVpc2VyJ10pXHJcbiAgICAgICAgcmVuZGVyX3NoaXBfbmV3KHBsYXllcl9pZCwnc3VibWFyaW5lJywzLHBsYXllcl9zaGlwc1snc3VibWFyaW5lJ10pXHJcbiAgICAgICAgcmVuZGVyX3NoaXBfbmV3KHBsYXllcl9pZCwnZGVzdHJveWVyJywyLHBsYXllcl9zaGlwc1snZGVzdHJveWVyJ10pXHJcbiAgICB9XHJcbiAgICBcclxuICAgIFxyXG4gICAgZnVuY3Rpb24gcmVuZGVyX3NoaXBfbmV3KHBsYXllcl9pZCxzaGlwX2lkLCBzaGlwX2xlbmd0aCwgc2hpcF9hcnJheSl7XHJcbiAgICAgICAgbGV0IHNoaXAgPSBzaGlwX2FycmF5XHJcbiAgICAgICAgY29uc3QgZ2FtZV9jZWxscyA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChgLmdyaWQtY2VsbC0ke3BsYXllcl9pZH0tYm9hcmRgKSk7XHJcbiAgICAgICAgbGV0IHhfY29vcmQgPSBzaGlwWzBdWzBdXHJcbiAgICAgICAgbGV0IHNwbGl0dGVkID0gcmVuZGVyX3NoaXBfcG9zaXRpb24oKVxyXG4gICAgICAgIGdhbWVfY2VsbHMuZm9yRWFjaCgoY2VsbCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyh4X2Nvb3JkID09IGNlbGwuZGF0YXNldC54KVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgbGV0IGZvdW5kX2FycmF5ID0gZ2FtZV9jZWxscy5maWx0ZXIoKGNlbGwpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIGNlbGwuZGF0YXNldC54ID09IHhfY29vcmRcclxuICAgICAgICB9KVxyXG4gICAgICAgIGNvbnNvbGUubG9nKGZvdW5kX2FycmF5KVxyXG4gICAgICAgIGxldCBoYWxmID0gTWF0aC5jZWlsKGZvdW5kX2FycmF5Lmxlbmd0aCAvIDIpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdUaGlzIGlzIGZvdW5kIGFycmF5IGJlZm9yZSBzcGxpdCcsIGZvdW5kX2FycmF5KVxyXG4gICAgICAgIGlmIChzcGxpdHRlZCA9PT0gMCl7XHJcbiAgICAgICAgICAgIGxldCBmaXJzdEhhbGYgPSBmb3VuZF9hcnJheS5zbGljZSgwLGhhbGYpXHJcbiAgICAgICAgICAgIC5zbGljZSgwLGhhbGYpXHJcbiAgICAgICAgICAgIC5zbGljZSgwLHNoaXBfbGVuZ3RoKVxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnVGhpcyBpcyB0aGUgZm91bmQgYXJyYXkgbm93IGZpcnN0IGhhbGYnLCBmaXJzdEhhbGYpXHJcbiAgICAgICAgICAgIGZpcnN0SGFsZi5mb3JFYWNoKChjZWxsKSA9PiBjZWxsLmNsYXNzTmFtZSA9IGBncmlkLWNlbGwtJHtwbGF5ZXJfaWR9LWJvYXJkICR7c2hpcF9pZH1gKVxyXG4gICAgICAgIH0gZWxzZXtcclxuICAgICAgICAgICAgbGV0IHNlY29uZEhhbGYgPSBmb3VuZF9hcnJheVxyXG4gICAgICAgICAgICAuc2xpY2UoaGFsZilcclxuICAgICAgICAgICAgLnNsaWNlKGAtJHtzaGlwX2xlbmd0aH1gKVxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnVGhpcyBpcyB0aGUgZm91bmQgYXJyYXkgbm93IHNlY29uZCBoYWxmJywgc2Vjb25kSGFsZilcclxuICAgICAgICAgICAgc2Vjb25kSGFsZi5mb3JFYWNoKChjZWxsKSA9PiBjZWxsLmNsYXNzTmFtZSA9IGBncmlkLWNlbGwtJHtwbGF5ZXJfaWR9LWJvYXJkICR7c2hpcF9pZH1gKSAgIFxyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zb2xlLmxvZygnR3JhYiBzaGlwIGNvb3JkcyBmdW5jdGlvbicsIGdyYWJfc2hpcF9jb29yZGluYXRlcyhwbGF5ZXJfaWQsYCR7c2hpcF9pZH1gKSlcclxuICAgICAgICBpZiAocGxheWVyX2lkID09PSBnYW1lLmFpYm90LmlkKXtcclxuICAgICAgICAgICAgc2hpcF9waWVjZXNfRE9NX2JvdFtgJHtzaGlwX2lkfWBdID0gZ3JhYl9zaGlwX2Nvb3JkaW5hdGVzKHBsYXllcl9pZCxgJHtzaGlwX2lkfWApXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdUaGlzIGlzIHRoZSBTSElQUyBmcm9tIGJvdCBET00gbm93Jywgc2hpcF9waWVjZXNfRE9NX2JvdClcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgc2hpcF9waWVjZXNfRE9NW2Ake3NoaXBfaWR9YF0gPSBncmFiX3NoaXBfY29vcmRpbmF0ZXMocGxheWVyX2lkLGAke3NoaXBfaWR9YClcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1RoaXMgaXMgdGhlIFNISVBTIGZyb20gRE9NIG5vdycsIHNoaXBfcGllY2VzX0RPTSlcclxuICAgICAgICB9ICBcclxuICAgIH1cclxuICAgIFxyXG4gICAgY29uc3QgcmVuZGVyX3NoaXBfcG9zaXRpb24gPSAoKSA9PiB7XHJcbiAgICAgICAgbGV0IG51bWJlciA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIpXHJcbiAgICAgICAgcmV0dXJuIG51bWJlclxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBjb25zdCBncmFiX3NoaXBfY29vcmRpbmF0ZXMgPSAocGxheWVyX2lkLHNoaXBfaWQpID0+e1xyXG4gICAgICAgIGxldCBjb29yZHNfYXJyYXkgPSBbXTtcclxuICAgICAgICBjb25zdCBnYW1lX2NlbGxzID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGAuZ3JpZC1jZWxsLSR7cGxheWVyX2lkfS1ib2FyZGApKTtcclxuICAgICAgICBnYW1lX2NlbGxzLmZvckVhY2goKGNlbGwpPT4ge1xyXG4gICAgICAgICAgICBpZiAoY2VsbC5jbGFzc0xpc3QuY29udGFpbnMoc2hpcF9pZCkpe1xyXG4gICAgICAgICAgICAgICAgY29vcmRzX2FycmF5LnB1c2goW2NlbGwuZGF0YXNldC54LGNlbGwuZGF0YXNldC55XSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgcmV0dXJuIGNvb3Jkc19hcnJheVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyoqIE5lZWRzIHRvIGJlIHdvcmtlZCBvbiEgKiovXHJcbiAgICAvLyBmdW5jdGlvbiByZW5kZXJfaGl0cyhpZCl7XHJcbiAgICAvLyAgICAgY29uc3QgY2VsbF9hcnJheSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoYC5ncmlkLWNlbGwtJHtpZH0tYm9hcmRgKTtcclxuICAgIC8vICAgICBjZWxsX2FycmF5LmZvckVhY2goKGNlbGwpID0+IHtcclxuICAgIC8vICAgICAgICAgY29uc29sZS5sb2coJ3RoaXMgd29ya3MgcmVuZGVyIGhpdHMgbG9sJylcclxuICAgIC8vICAgICAgICAgaWYgKGNlbGwudGV4dENvbnRlbnQgPT0gJ1gnICYmIGNlbGwuY2xhc3NMaXN0LmNvbnRhaW5zKCdjYXJyaWVyJykpe1xyXG4gICAgLy8gICAgICAgICAgICAgY2VsbC5jbGFzc05hbWUgPSBgZ3JpZC1jZWxsLSR7aWR9LWJvYXJkIGhpdGBcclxuICAgIC8vICAgICAgICAgfVxyXG4gICAgLy8gICAgICAgICBpZiAoY2VsbC50ZXh0Q29udGVudCA9PSAnWCcgJiYgY2VsbC5jbGFzc0xpc3QuY29udGFpbnMoJ2JhdHRsZXNoaXAnKSl7XHJcbiAgICAvLyAgICAgICAgICAgICBjZWxsLmNsYXNzTmFtZSA9IGBncmlkLWNlbGwtJHtpZH0tYm9hcmQgaGl0YFxyXG4gICAgLy8gICAgICAgICB9XHJcbiAgICAvLyAgICAgICAgIGlmIChjZWxsLnRleHRDb250ZW50ID09ICdYJyAmJiBjZWxsLmNsYXNzTGlzdC5jb250YWlucygnZGVzdHJveWVyJykpe1xyXG4gICAgLy8gICAgICAgICAgICAgY2VsbC5jbGFzc05hbWUgPSBgZ3JpZC1jZWxsLSR7aWR9LWJvYXJkIGhpdGBcclxuICAgIC8vICAgICAgICAgfVxyXG4gICAgLy8gICAgICAgICBpZiAoY2VsbC50ZXh0Q29udGVudCA9PSAnWCcgJiYgY2VsbC5jbGFzc0xpc3QuY29udGFpbnMoJ3N1Ym1hcmluZScpKXtcclxuICAgIC8vICAgICAgICAgICAgIGNlbGwuY2xhc3NOYW1lID0gYGdyaWQtY2VsbC0ke2lkfS1ib2FyZCBoaXRgXHJcbiAgICAvLyAgICAgICAgIH1cclxuICAgIC8vICAgICAgICAgaWYgKGNlbGwudGV4dENvbnRlbnQgPT0gJ1gnICYmIGNlbGwuY2xhc3NMaXN0LmNvbnRhaW5zKCdjcnVpc2VyJykpe1xyXG4gICAgLy8gICAgICAgICAgICAgY2VsbC5jbGFzc05hbWUgPSBgZ3JpZC1jZWxsLSR7aWR9LWJvYXJkIGhpdGBcclxuICAgIC8vICAgICAgICAgfVxyXG4gICAgLy8gICAgIH0pXHJcbiAgICAvLyB9XHJcbiAgICAvLyBSZW5kZXIgdGhlIGdyaWQgYm9hcmRzIGZvciBwbGF5ZXIgYW5kIEFJXHJcbiAgICBmdW5jdGlvbiBjcmVhdGVfZ3JpZChpZCl7XHJcbiAgICAgICAgY29uc3QgYm9hcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAuJHtpZH1gKVxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTA7IGkrKyl7XHJcbiAgICAgICAgICAgIGxldCByb3cgPSBpO1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwOyBpKyspe1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgICAgICBkaXYuY2xhc3NOYW1lID0gYGdyaWQtY2VsbC0ke2lkfWBcclxuICAgICAgICAgICAgICAgIGRpdi5pZCA9IGAke2lkLnNwbGl0KCctJylbMF19YFxyXG4gICAgICAgICAgICAgICAgZGl2LnNldEF0dHJpYnV0ZSgnZGF0YS14Jywgcm93KVxyXG4gICAgICAgICAgICAgICAgZGl2LnNldEF0dHJpYnV0ZSgnZGF0YS15JywgaSlcclxuICAgICAgICAgICAgICAgIGRpdi5zdHlsZS5ib3JkZXIgPSBgMXB4IHNvbGlkIGJsYWNrYFxyXG4gICAgICAgICAgICAgICAgZGl2LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBkaXYudGV4dENvbnRlbnQgPSBgWGA7XHJcbiAgICAgICAgICAgICAgICAgICAgYWRkaGl0TGlzdGVuZXIoW2UudGFyZ2V0LmlkLGUudGFyZ2V0LmRhdGFzZXQueCxlLnRhcmdldC5kYXRhc2V0LnldKTtcclxuICAgICAgICAgICAgICAgICAgICByZW5kZXJfaGl0cyhpZClcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICBib2FyZC5hcHBlbmRDaGlsZChkaXYpIFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICAvL0RPTSByZW5kZXIgaGl0IGZ1bmN0aW9uXHJcbiAgICBmdW5jdGlvbiBhZGRoaXRMaXN0ZW5lcihhcnJheSl7XHJcbiAgICAgICAgbGV0IFtpZCx4X2Nvb3JkLHlfY29vcmRdID0gYXJyYXk7XHJcbiAgICAgICAgcmV0dXJuIGdhbWUuY2hlY2tfaWZfc2hpcF9oaXQoW2lkLHhfY29vcmQseV9jb29yZF0pXHJcbiAgICB9XHJcbiAgICBjcmVhdGVfZ3JpZChgJHtnYW1lLnBsYXllci5pZH0tYm9hcmRgKTtcclxuICAgIGNyZWF0ZV9ncmlkKGAke2dhbWUuYWlib3QuaWR9LWJvYXJkYCk7XHJcbiAgICBwdXRfaW5fc2hpcHMoZ2FtZS5wbGF5ZXIuaWQsZ2FtZS5wbGF5ZXIuZ2V0X3NoaXBzKCkpO1xyXG4gICAgcHV0X2luX3NoaXBzKGdhbWUuYWlib3QuaWQsZ2FtZS5haWJvdC5nZXRfc2hpcHMoKSk7XHJcblxyXG4gICAgZ2FtZS51cGRhdGVfY29vcmRpbmF0ZXMoZ2FtZS5wbGF5ZXIuaWQsc2hpcF9waWVjZXNfRE9NKVxyXG4gICAgZ2FtZS51cGRhdGVfY29vcmRpbmF0ZXMoZ2FtZS5haWJvdC5pZCxzaGlwX3BpZWNlc19ET01fYm90KVxyXG5cclxuICAgIHJldHVybiB7IGNyZWF0ZV9ncmlkX2JveGVzLCBjcmVhdGVfZ3JpZCwgcHV0X2luX3NoaXBzIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgRE9NO1xyXG5cclxuIiwiaW1wb3J0IFNoaXAgZnJvbSBcIi4vc2hpcC5qc1wiO1xyXG5cclxuY29uc3QgZ2FtZUJvYXJkID0gKCkgPT4ge1xyXG4gICAgbGV0IHBsYXllciA9IFNoaXAoJ3BsYXllcicpXHJcbiAgICBsZXQgYWlib3QgPSBTaGlwKCdhaWJvdCcpXHJcbiAgICBmdW5jdGlvbiB1cGRhdGVfY29vcmRpbmF0ZXMocGxheWVyX2lkLHNoaXBfZG9tX3BpZWNlcyl7XHJcbiAgICAgICAgaWYgKHBsYXllcl9pZCA9PT0gcGxheWVyLmlkKXtcclxuICAgICAgICAgICAgcGxheWVyLnVwZGF0ZV9zaGlwX2FycmF5KHNoaXBfZG9tX3BpZWNlcylcclxuICAgICAgICB9IGVsc2V7XHJcbiAgICAgICAgICAgIGFpYm90LnVwZGF0ZV9zaGlwX2FycmF5KHNoaXBfZG9tX3BpZWNlcylcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gY2hlY2tfaWZfc2hpcF9oaXQoY29vcmRzKXtcclxuICAgICAgICBsZXQgW2lkLHhfY29vcmQseV9jb29yZF0gPSBjb29yZHNcclxuICAgICAgICBjb25zb2xlLmxvZygnSEVSRSBJUyBUSEUgSUQgJywgaWQpXHJcbiAgICAgICAgY29uc29sZS5sb2coJ0hFUkUgSVMgVEhFIHggJywgeF9jb29yZClcclxuICAgICAgICBjb25zb2xlLmxvZygnSEVSRSBJUyBUSEUgeSAnLCB5X2Nvb3JkKVxyXG4gICAgICAgIGlmIChpZCA9PT0gcGxheWVyLmlkKXtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1BsYXllciBjZWxsIHdhcyBjbGlja2VkIG9uLicpXHJcbiAgICAgICAgICAgIGFpYm90LmhpdChwbGF5ZXIsW3hfY29vcmQseV9jb29yZF0pXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdQbGF5ZXIgc2hpcHMgYWZ0ZXIgZXZlcnl0aGluZyB3YXMgdXBkYXRlZC9kZWxldGVkJywgcGxheWVyLmdldF9zaGlwcygpKVxyXG4gICAgICAgIH0gZWxzZSBpZiAoaWQgPT09IGFpYm90LmlkKXtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ0FpIGJvdCBjZWxsIHdhcyBjbGlja2VkIG9uLicpXHJcbiAgICAgICAgICAgIHBsYXllci5oaXQoYWlib3QsIFt4X2Nvb3JkLHlfY29vcmRdKVxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnQUkgYm90IHNoaXBzIGFmdGVyIGV2ZXJ5dGhpbmcgd2FzIHVwZGF0ZWQvZGVsZXRlZCcsIGFpYm90LmdldF9zaGlwcygpKVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm47XHJcbiAgICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsgIHBsYXllciwgYWlib3QsIHVwZGF0ZV9jb29yZGluYXRlcywgY2hlY2tfaWZfc2hpcF9oaXQgIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgZ2FtZUJvYXJkOyIsImltcG9ydCBET00gZnJvbSBcIi4vbW9kdWxlcy9ET01cIjtcclxuXHJcblxyXG5cclxuXHJcbkRPTSgpO1xyXG5cclxuIl0sIm5hbWVzIjpbImlkIiwidW5pcXVlX251bWJlcnMiLCJjb3VudCIsInNoaXAiLCJsZW5ndGgiLCJyYW5kb21OdW0iLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJpbmRleE9mIiwicHVzaCIsImdlbmVyYXRlX3VuaXF1ZV9jb29yZGluYXRlcyIsImdlbmVyYXRlX3NoaXBfY29vcmRpbmF0ZXMiLCJ4X2Nvb3JkIiwic2hpcF9hcnJheSIsImkiLCJzaGlwX3BpZWNlcyIsImNhcnJpZXIiLCJiYXR0bGVzaGlwIiwiY3J1aXNlciIsInN1Ym1hcmluZSIsImRlc3Ryb3llciIsImdldF9zaGlwcyIsImhpdCIsInBvc2l0aW9uIiwicGxheWVyIiwiY29uc29sZSIsImxvZyIsInNoaXBfbmFtZSIsInNoaXBfcG9zaXRpb24iLCJncmFiX3Bvc2l0aW9uIiwicmVtb3ZlX3BpZWNlIiwiaXNTdW5rIiwicG9zaXRpb25fcmVmZXJlbmNlIiwiZmluZCIsImNlbGwiLCJKU09OIiwic3RyaW5naWZ5Iiwic3BsaWNlIiwicHJvcGVydHkiLCJjb29yZHNfcmVzdWx0IiwidW5kZWZpbmVkIiwidXBkYXRlX3NoaXBfYXJyYXkiLCJzaGlwX3BpZWNlc19kb20iLCJnYW1lIiwiYWlib3QiLCJ1cGRhdGVfY29vcmRpbmF0ZXMiLCJwbGF5ZXJfaWQiLCJzaGlwX2RvbV9waWVjZXMiLCJjaGVja19pZl9zaGlwX2hpdCIsImNvb3JkcyIsInlfY29vcmQiLCJzaGlwX3BpZWNlc19ET00iLCJzaGlwX3BpZWNlc19ET01fYm90IiwicHV0X2luX3NoaXBzIiwicGxheWVyX3NoaXBzX29iamVjdHMiLCJwbGF5ZXJfc2hpcHMiLCJyZW5kZXJfc2hpcF9uZXciLCJzaGlwX2lkIiwic2hpcF9sZW5ndGgiLCJnYW1lX2NlbGxzIiwiQXJyYXkiLCJmcm9tIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwic3BsaXR0ZWQiLCJyZW5kZXJfc2hpcF9wb3NpdGlvbiIsImZvckVhY2giLCJkYXRhc2V0IiwieCIsImZvdW5kX2FycmF5IiwiZmlsdGVyIiwiaGFsZiIsImNlaWwiLCJmaXJzdEhhbGYiLCJzbGljZSIsImNsYXNzTmFtZSIsInNlY29uZEhhbGYiLCJncmFiX3NoaXBfY29vcmRpbmF0ZXMiLCJjb29yZHNfYXJyYXkiLCJjbGFzc0xpc3QiLCJjb250YWlucyIsInkiLCJjcmVhdGVfZ3JpZCIsImJvYXJkIiwicXVlcnlTZWxlY3RvciIsInJvdyIsImRpdiIsImNyZWF0ZUVsZW1lbnQiLCJzcGxpdCIsInNldEF0dHJpYnV0ZSIsInN0eWxlIiwiYm9yZGVyIiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJ0ZXh0Q29udGVudCIsImFkZGhpdExpc3RlbmVyIiwidGFyZ2V0IiwicmVuZGVyX2hpdHMiLCJhcHBlbmRDaGlsZCIsImFycmF5Il0sInNvdXJjZVJvb3QiOiIifQ==